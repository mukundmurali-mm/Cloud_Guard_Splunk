{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"CD3 Automation Toolkit","text":""},{"location":"#introduction","title":"Introduction","text":"<p>CD3 stands for Cloud Deployment Design Deliverable. The CD3 Automation toolkit has been developed to help in automating the OCI resource object management.   It reads input data in the form of CD3 Excel sheet and generates Terraform files which can be used to provision the resources in OCI instead of handling the task through the OCI console manually. The toolkit also reverse engineers the components in OCI back to the Excel sheet and Terraform configuration. The toolkit can be used throughout the lifecycle of tenancy to continuously create or modify existing resources. The generated Terraform code can be used by the OCI Resource Manager or can be integrated into organization's existing devops CI/CD ecosystem.  </p> <p> Part 1- Introduction to CD3 Automation Toolkit \u2013  6m \u2013 Introduction to CD3 Automation Toolkit. </p>"},{"location":"#supported-oci-services","title":"Supported OCI Services","text":"OCI Services Details IAM/Identity Compartments, Groups, Dynamic Groups, Policies, Users, Network Sources Governance Tags (Namespaces, Tag Keys, Defined Tags, Default Tags, Cost Tracking) Network VCNs, Subnets, VLANs, DRGs, IGWs, NGWs, LPGs, Route Tables, DRG Route, Tables, Security Lists, Network Security Groups, Remote Peering Connections, Application Load Balancer, Network Load Balancers DNS Management Private DNS - Views, Zones, rrsets/records and Resolvers Compute Instances supporting Market Place Images, Remote Exec, Cloud-Init scripts, Dedicated VM Hosts Storage FSS, Block and Boot Volumes, Backup Policies, Object Storage Buckets and logging for write events Database Exa Infra, ExaCS, DB Systems VM and BM, ATP, ADW Management Services Events, Notifications, Alarms, Service Connector Hub (SCH) Developer Services Resource Manager, Oracle Kubernetes Engine (OKE) Logging Services VCN Flow Logs, LBaaS access and error Logs, OSS Buckets write Logs SDDCs  Oracle Cloud VMWare Solutions (Single Cluster is supported as of now. Multi-cluster support will be included in the upcoming release) CIS Landing Zone Compliance Download and Execute CIS Compliance Check Script, Cloud Guard, Key Vault, Budget Policy Enforcement OPA - Open Policy Agent <p>Click here to get started and manage your OCI Infra!</p>"},{"location":"#contributing","title":"Contributing","text":"<p>This project is open source.  Please submit your contributions by raising an Issue or through Discussion topic in this repository. Currently, we do not accept any pull requests. Oracle appreciates any contributions that are made by the open source community.</p>"},{"location":"#license","title":"License","text":"<p>Copyright \u00a9 2022 Oracle and/or its affiliates.</p> <p>Licensed under the Universal Permissive License (UPL), Version 1.0.</p> <p>See LICENSE for more details.</p> <p>ORACLE AND ITS AFFILIATES DO NOT PROVIDE ANY WARRANTY WHATSOEVER, EXPRESS OR IMPLIED, FOR ANY SOFTWARE, MATERIAL OR CONTENT OF ANY KIND CONTAINED OR PRODUCED WITHIN THIS REPOSITORY, AND IN PARTICULAR SPECIFICALLY DISCLAIM ANY AND ALL IMPLIED WARRANTIES OF TITLE, NON-INFRINGEMENT, MERCHANTABILITY, AND FITNESS FOR A PARTICULAR PURPOSE.  FURTHERMORE, ORACLE AND ITS AFFILIATES DO NOT REPRESENT THAT ANY CUSTOMARY SECURITY REVIEW HAS BEEN PERFORMED WITH RESPECT TO ANY SOFTWARE, MATERIAL OR CONTENT CONTAINED OR PRODUCED WITHIN THIS REPOSITORY. IN ADDITION, AND WITHOUT LIMITING THE FOREGOING, THIRD PARTIES MAY HAVE POSTED SOFTWARE, MATERIAL OR CONTENT TO THIS REPOSITORY WITHOUT ANY REVIEW. USE AT YOUR OWN RISK.</p>"},{"location":"CD3%20Overview/","title":"CD3 Overview","text":"<p> CD3 Automation Toolkit Explained in 1 minute \u2013  1m \u2013 Understand what is CD3 Automation toolkit.</p> <ul> <li> <p> Getting Started</p> <p> Introduction  What's new in this release  Toolkit Supported OCI Services  Excel Templates</p> </li> <li> <p> Deploying CD3</p> <p> Prerequisites  Launch the container  Connect container to OCI tenancy  Steps to Upgrade Your Toolkit</p> </li> <li> <p> CD3 - CLI</p> <p> Before you Begin  Create resources in OCI (Greenfield Workflow)  Export Resources from OCI (Non-Greenfield Workflow)  Enforcing OPA (Open Policy Agent) policies for Terraform  Must Read- Managing Network for Greenfield Workflow  Must Read- Managing Compute Instances for Greefield Workflow  Must Read- Managing Network for Non-Greenfield Workflow  Must Read- Managing Compute Instances for Non-Greenfield Workflow</p> </li> <li> <p> CD3 - Jenkins</p> <p> Before you Begin  Introduction to Jenkins with the toolkit  Create resources in OCI via Jenkins(Greenfield Workflow)  Must Read- Managing Network for Greenfield Workflow  Must Read- Provisioning of Resources - Instances/OKE/SDDC/Database  Must Read- Provisioning of multiple services together  Export Resources from OCI via Jenkins(Non-Greenfield Workflow)  Switch between CLI and Jenkins  Remote Management of Terraform State File</p> </li> <li> <p> Additional Features</p> <p> Grouping of generated Terraform files  OCI Resource Manager Upload  Additional CIS Compliance Features  CD3 Validator Features  Support for Additional Attributes  Migrate Jenkins configuration to Customer Environment</p> </li> <li> <p> Learning CD3</p> <p> Blog  Automation Toolkit Learning Videos</p> </li> </ul>"},{"location":"CD3ExcelTabs/","title":"OCI services supported by toolkit","text":""},{"location":"CD3ExcelTabs/#oci-services-currently-supported-by-automation-toolkit","title":"OCI Services currently supported by Automation Toolkit","text":"<p>Click on the links below to know about the specifics of each tab in the excel sheet.</p>"},{"location":"CD3ExcelTabs/#iamidentity","title":"IAM/Identity","text":"<ul> <li> <p>Compartments</p> </li> <li> <p>Groups</p> </li> <li> <p>Policies</p> </li> <li> <p>Users</p> </li> <li> <p>Network Sources</p> </li> </ul> <p> Click here to view sample auto.tfvars for the Identity components </p>"},{"location":"CD3ExcelTabs/#governance","title":"Governance","text":"<ul> <li>Tags</li> </ul> <p>Click here to view sample auto.tfvars for Governance components </p>"},{"location":"CD3ExcelTabs/#network","title":"Network","text":"<ul> <li> <p>VCNs</p> </li> <li> <p>DRGs</p> </li> <li> <p>VCN Info</p> </li> <li> <p>DHCP</p> </li> <li> <p>SubnetsVLANs</p> </li> </ul> <p>Click here to view sample auto.tfvars for all Network components- VCNs, Subnets, Gateways etc., </p>"},{"location":"CD3ExcelTabs/#private-dns","title":"Private-DNS","text":"<ul> <li> <p>DNS-Views-Zones-Records</p> </li> <li> <p>DNS-Resolvers</p> </li> </ul> <p>Click here to view sample auto.tfvars for all DNS components  </p>"},{"location":"CD3ExcelTabs/#load-balancer","title":"Load Balancer","text":"<ul> <li> <p>LB-Hostname-Certs Tab</p> </li> <li> <p>LB-Backend Set and Backend Servers</p> </li> <li> <p>LB-RuleSet</p> </li> <li> <p>LB-PathRouteSet</p> </li> <li> <p>LB-Listener</p> </li> </ul> <p>Click here to view sample auto.tfvars for all Load Balancer components- Cipher suits,Backend sets, rule sets etc.,</p>"},{"location":"CD3ExcelTabs/#compute","title":"Compute","text":"<ul> <li> <p>DedicatedVMHosts</p> </li> <li> <p>Instances</p> </li> </ul> <p>Click here to view sample auto.tfvars for Compute components-Virtual Machine </p>"},{"location":"CD3ExcelTabs/#storage","title":"Storage","text":"<ul> <li>BlockVolumes</li> </ul> <p>Click here to view sample auto.tfvars for Block Volumes  </p> <ul> <li> <p>FSS</p> </li> <li> <p>Object Storage Buckets</p> </li> </ul> <p>Click here to view sample auto.tfvars for Object Storage Buckets </p>"},{"location":"CD3ExcelTabs/#database","title":"Database","text":"<ul> <li> <p>DBSystems-VM-BM</p> </li> <li> <p>ExaCS</p> </li> <li> <p>ADB</p> </li> </ul>"},{"location":"CD3ExcelTabs/#management-services","title":"Management Services","text":"<ul> <li> <p>Notifications</p> </li> <li> <p>Alarms</p> </li> </ul> <p>Click here to view sample auto.tfvars for management services Alarms, Notifications, Events etc., </p> <ul> <li>ServiceConnectors </li> </ul> <p>Click here to view sample auto.tfvars for Service Connectors </p>"},{"location":"CD3ExcelTabs/#developer-services","title":"Developer Services","text":"<ul> <li>OKE</li> </ul> <p>Click here to view sample auto.tfvars for OKE components- Clusters, Nodepools </p>"},{"location":"CD3ExcelTabs/#logging-services","title":"Logging Services","text":"<ul> <li>VCN Flow Logs</li> <li>LBaaS Logs</li> <li>OSS Logs</li> </ul> <p>Click here to view sample auto.tfvars for Logging components  </p>"},{"location":"CD3ExcelTabs/#sddcs-tab","title":"SDDCs Tab","text":"<ul> <li>OCVS</li> </ul> <p>Click here to view sample auto.tfvars for OCVS  </p>"},{"location":"CISFeatures/","title":"Additional CIS Compliance Features","text":""},{"location":"CISFeatures/#additional-cis-compliance-features","title":"Additional CIS Compliance Features","text":"<p>These are some additional \"CIS Compliance Features\" which are not part of CD3 Excel sheet but just included into setUpOCI Menu.</p>"},{"location":"CISFeatures/#1-run-cis-compliance-checker-script","title":"1. Run CIS compliance checker script","text":"<p>You can choose to run CIS compliance checker script against your tennacy using the Automation Toolkit itself. It also enables you to download the latest script if needed. Folder with name _cis_report gets created under /cd3user/tenancies// and it contains all the reports genertaed by the script. As a best practice, the script should be executed after every deployment in the tenancy. The output report should be analysed to minimise the reported anomalies as per the design requirements."},{"location":"CISFeatures/#2-create-keyvault","title":"2. Create Key/Vault:","text":"<p>Below tf file is created</p> File name Description cis-keyvault.auto.tfvars TF variables file for creating the key/vault in the specified compartment and region. This is created under the specified region directory."},{"location":"CISFeatures/#3-create-default-budget","title":"3. Create Default Budget:","text":"<p>This option will ask for monthly budget (in US$) and Threshold percentage of Budget and bellow tf files are created:</p> File name Description cis-budget.auto.tfvars TF variables file for crating budget."},{"location":"CISFeatures/#4-enable-cloud-guard","title":"4. Enable Cloud guard","text":"<p>This will enable Cloud guard for the tenancy from specified reporting region, clones the Oracle Managed detector and responder recipes. Creates a target for root compartment with the cloned recipes.</p> <p>Below TF file is created:</p> File name Description cis-cloudguard.auto.tf vars TF variables file for enabling cloud guard and creating target for root compartment."},{"location":"ComputeGF/","title":"Provisioning Compute Instances on OCI","text":"<p>Provisioning of compute instances using Automation Toolkit involves the below steps:</p> <ul> <li>Add the VM details to the \"Instances\" Excel Sheet.</li> <li>Running the toolkit to generate auto.tfvars.</li> <li>Executing Terraform commands to provision the resources in OCI.</li> </ul> <p>Note below points while adding VM details in the Instances sheet:</p> <ol> <li> <p>\"Display Name\" column is case sensitive. Specified value will be the display name of Instance in OCI console.</p> </li> <li> <p>Optional columns can also be left blank - like Fault Domain, IP Address. They will take default values when left empty.</p> </li> <li> <p>Leave columns: Backup Policy, NSGs, DedicatedVMHost blank if instance doesn't need to be part of any of these. Instances can be made a part of Backup Policy and NSGs later by choosing appropriate option in setUpOCI menu.</p> </li> </ol> <p>4.</p> <p>Note: The column \"SSH Key Var Name\" accepts SSH key value directly or the name of variable declared in variables.tf under the  instance_ssh_keys variable containing the key value. Make sure to have an entry in variables_\\.tf file with the name you enter in SSH Key Var Name field of the Excel sheet and put the value as SSH key value. <p>For Eg: If you enter the SSH Key Var Name as ssh_public_key, make an entry in variables_\\.tf file as shown below: <pre><code>variable  'instance_ssh_keys'  {\ntype = map(any)\ndefault = {\nssh_public_key = \"&lt;SSH PUB KEY STRING HERE&gt;\"\n# Use '\\n' as the delimiter to add multiple ssh keys.\n# Example: ssh_public_key = \"ssh-rsa AAXXX......yhdlo\\nssh-rsa AAxxskj...edfwf\"\n#START_instance_ssh_keys#\n# exported instance ssh keys\n#instance_ssh_keys_END#\n  }\n}\n</code></pre> <ol> <li> <p>Enter subnet name column value as: \\_\\ <li> <p>Source Details column of the excel sheet accepts both image and boot volume as the source for instance to be launched.</p> </li> <p>Format:</p> <pre><code>       image::\\&lt;variable containing ocid of image&gt; or\n       bootVolume::\\&lt;variable containing ocid of boot volume&gt;\n</code></pre> <p>Make sure to have an entry in variables_\\.tf file for the value you enter in Source Details field of the Excel sheet. Ex: If you enter the Source Details as image::Linux, make an entry in variables_\\.tf file under the instance_source_ocids variable as shown below: <pre><code>variable 'instance_source_ocids' {\n type = map(any)\n Linux    = \"&lt;LATEST LINUX OCID HERE&gt;\"\n Windows  = \"&lt;LATEST WINDOWS OCID HERE&gt;\"\n PaloAlto = \"Palo Alto Networks VM-Series Next Generation Firewall\"\n #START_instance_source_ocids#\n # exported instance image ocids\n #instance_source_ocids_END#\n}\n</code></pre> <ol> <li> <p>Mention shape to be used in Shape column of the excel sheet. If Flex shape is to be used format is:</p> <pre><code> shape::ocpus\n\n eg: VM.Standard.E3.Flex::5\n</code></pre> </li> <li> <p>Custom Policy Compartment Name : Specify the compartment name where the Custom Policy is created.</p> </li> <li>Create_Is PV Encryption In Transit Enabled attribute should be set to True to enable encryption for new instances. Default is False.</li> <li>Update_Is PV Encryption In Transit Enabled attribute should be set to True to enable encryption for existing instances.</li> <li>Add any additonal attributes (not part of excel sheet already) as per  this.</li> <li>To enable or disable a plugin for the instance add new column with name as 'Plugin \\'  eg 'Plugin Bastion'.     Valid values are Enabled or Disabled"},{"location":"ComputeGF/#remote-executioncloud-init-scenarios","title":"Remote Execution/Cloud Init Scenarios","text":""},{"location":"ComputeGF/#managing-remote-execution","title":"Managing Remote Execution","text":"<p>NOTE- Before you start with configuring remote execution for OCI instance(s) please ensure network connectivity through Bastion host or direct reach to the OCI instance(s) from where terraform is being invoked.</p> <p>Remote execution should be used as the last resort or only during initial provisioning for a given OCI instance(s). This feature cannot be used for export of instances.</p> <ul> <li>Add the 'Remote Execute' columm to the excel sheet for the corresponding instance entry. Format is: bastion_ip@ <li>Please skip bastion_ip if there is direct connectivity with target servers via VPN.</li> <li>Scripts folder should have the ansible script files or shell script files and ssh-keys for instances and bastion host. The *.yaml or *.yml extensions will be considered for the ansible script files and .sh extensions will be considered for shell scripts files.</li> <li>For block-volume attachment configuration via ansible playbook the device name is must, and it's currently set to \"/dev/oracleoci/oraclevdb\" in the sample ansible playbook.</li> <li>Common scenarios like security hardening and other common shell scripts can be executed against the OCI instances during provisioning.</li> <li>Running the CD3 automation toolkit will generate auto.tfvars.</li> <li>Execute Terraform commands to provision the instances in OCI. Remote executioner will also run after the instance provisioning.</li> <p>The users can refer to the <code>default.yaml</code> file which is inside /cd3user/tenancies//terraform_files//scripts dir for provisioning the custom playbooks."},{"location":"ComputeGF/#managing-cloud-init","title":"Managing Cloud Init","text":"<ul> <li>Add the 'Cloud Init Script' column to the excel sheet for the corresponding instance entry.</li> <li>Scripts folder should have the relevant script files for instances. The *.sh extension(s) will be considered for the script files.</li> <li>Common scenarios like security hardening and other common scripts can be executed against the OCI instances during provisioning.</li> <li>Running the CD3 automation toolkit will generate auto.tfvars.</li> <li>Execute Terraform commands to provision the instances in OCI and run cloud-init scripts during provisioning.</li> </ul>"},{"location":"ComputeGF/#executing-the-setupocipy-script","title":"Executing the setUpOCI.py script:","text":"<p>On choosing \"Compute\" in the SetUpOCI menu and \"Add/Modify/Delete Instances/Boot Backup Policy\" submenu will allow to launch your VM on OCI tenancy.</p> <p>Output terraform file generated: \\/\\/\\_instances.auto.tfvars and \\/\\/\\_boot-backup-policy.auto.tfvars  under  appropriate \\ directory. <p>Once the terraform apply is complete, view the resources under Compute -&gt; Instances for the region.</p> <p>On re-running the same option you will find the previously existing files being backed up under directory \u2192   \\/\\/backup_instances/\\-\\-\\. <p></p>   | :arrow_backward: Prev | Next :arrow_forward: | | :---- | -------: |"},{"location":"ComputeNGF/","title":"Exporting Compute Instances from OCI","text":"<p>Follow the below steps to export OCI compute Instances to CD3 Excel file and create the terraform state:</p> <ol> <li>Use the CD3-Blank-Template.xlsx to export existing OCI VM details into the \"Instances\" sheet.</li> <li>Add any additonal attributes (not part of excel sheet already) which needs to be exported as per this.</li> <li>Make sure to export the VCNs and Subnets in which the Instances are present prior to exporting the Instance.</li> <li>Execute the setupOCI.py file with non_gf_tenancy parameter value to true:</li> </ol> <p><code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code> 5. Provide the region from where the Instances have to be exported. Specify comma separated values for multiple regions. 6. From the output menu, select Option 5: Export Compute &gt;&gt; Option 2: Export Instances. 7. Enter the compartment to which the Instances belong to. If you have to export Instances from multiple compartments, specify comma separated compartment values.    Specify the compartment name along with hierarchy in the below format:</p> <pre><code>    Parent Compartment1::Parent Compartment2::MyCompartment\n</code></pre> <p>7.To export only specific instances, specify the required filter values</p> <pre><code> - Enter comma separated list of display name patterns of the instances: \n - Enter comma separated list of ADs of the instances eg AD1,AD2,AD3:\n</code></pre> <ol> <li>Upon executing, the \"Instances\" sheet in input CD3 Excel is populated with the VMs details.</li> <li>The tf_import_commands_instances_nonGF.sh script, tfvars file are generated for the Instances under folder /cd3user/tenancies//terraform_files/. If you are using multiple outdirectories, they'll be located under the /cd3user/tenancies//terraform_files/compute folder. <li>The associated ssh public keys are placed under variables_.tf under the \"instance_ssh_keys\" variable. <li>While export of instances, it will fetch details for only the primary VNIC attached to the instance.</li> <li>Execute the .sh file ( sh tf_import_commands_instances_nonGF.sh) to generate terraform state file.</li> <li>Please read the known behaviour of toolkit for export of instances having multiple plugins.</li> <p></p>   | :arrow_backward: Prev | Next :arrow_forward: | | :---- | -------: |"},{"location":"Connect_container_to_OCI_Tenancy/","title":"Connect container to OCI Tenancy","text":"<p>Note:</p> <ul> <li>It is recommended to execute createTenancyConfig.py with a single  within that container. Even if it is run multiple times with different customer names, Jenkins will only be configured for  used while first time successful execution of the script. <li>If there is a new region subscription to the tenancy at a later stage of time, createTenancyConfig.py must be re-run by using the same tenancyconfig.properties file that was originally used to create the configuration. Re-execution will create new directory for the new region under <code>/cd3user/tenancies/&lt;customer_name&gt;/terraform_files</code> without touching the existing ones and will commit the latest terraform_files folder to DevOps GIT repo.</li>"},{"location":"Connect_container_to_OCI_Tenancy/#step-1-exec-into-the-container","title":"Step 1 - Exec into the Container:","text":"<ul> <li>Run  <code>docker ps</code>.  \u2192 Note down the container ID from this cmd output.</li> <li>Run  <code>docker exec -it &lt;container_id&gt; bash</code></li> </ul>"},{"location":"Connect_container_to_OCI_Tenancy/#step-2-choose-authentication-mechanism-for-oci-sdk","title":"Step 2 - Choose Authentication Mechanism for OCI SDK","text":"<ul> <li>Please click here to configure any one of the available authentication mechanisms.</li> </ul>"},{"location":"Connect_container_to_OCI_Tenancy/#step-3-edit-tenancyconfigproperties","title":"Step 3 - Edit tenancyconfig.properties:","text":"<ul> <li>Run <code>cd /cd3user/oci_tools/cd3_automation_toolkit/user-scripts/</code></li> <li>Fill the input parameters in tenancyconfig.properties file.</li> <li>Ensure to:<ul> <li>Have the details ready for the Authentication mechanism you are planning to use.</li> <li>Use the same customer_name for a tenancy even if the script needs to be executed multiple times.</li> <li>Review 'outdir_structure_file' parameter as per requirements. It is recommended to use seperate outdir structure to manage     a large number of resources. </li> <li>Review Advanced Parameters Section for CI/CD setup and be ready with user details that will be used to connect to DevOps Repo in OCI.              Specifying these parameters as 'yes' in properties file will create Object Storage Bucket and Devops Git Repo/Project/Topic in OCI     and enable toolkit usage via Jenkins. <p>The toolkit supports users in primary IDCS stripes or default domains only for DevOps GIT operations.</p> </li> </ul> </li> </ul>"},{"location":"Connect_container_to_OCI_Tenancy/#step-4-initialise-the-environment","title":"Step 4 - Initialise the environment:","text":"<ul> <li>Initialise your environment to use the Automation Toolkit. <code>python createTenancyConfig.py tenancyconfig.properties</code></li> </ul> <p>Note * If you are running docker container on a linux VM host, please refer to point no. 7 under FAQ to avoid any permission issues. * Running the above command immediately after adding API key to the user profile in OCI might result in Authentication Errors. In such cases, please retry after a minute. </p> <p>\u2192 Example execution of the script with Advanced Parameters for CI/CD:</p> <p></p>"},{"location":"Connect_container_to_OCI_Tenancy/#appendix","title":"Appendix","text":"Expand this to view the details of the files created on successful execution of above steps   | Files Generated | At File Path | Comment/Purpose | | --------------- | ------------ | --------------- | | setUpOCI.properties | ```/cd3user/tenancies//_setUpOCI.properties``` | Customer Specific properties | | outdir_structure_file.properties | ```/cd3user/tenancies//_outdir_structure_file``` | Customer Specific properties file for outdir structure. This file will not be generated if 'outdir_structure_file' parameter was set to empty(single outdir) in tenancyconfig.properties while running createTenancyConfig.py | | Region based directories | ```/cd3user/tenancies//terraform_files``` | Tenancy's subscribed regions based directories for the generation of terraform files.Each region directory will contain individual directory for each service based on the parameter 'outdir_structure_file' | | Variables File,Provider File, Root and Sub terraform modules | ```/cd3user/tenancies//terraform_files/``` | Required for terraform to work. Variables file and Provider file will be genrated based on authentication mechanism chosen.| | out file | ```/cd3user/tenancies//createTenancyConfig.out``` | This file contains a copy of information displayed as the console output. | | OCI Config File | ```/cd3user/tenancies//.config_files/_oci_config``` | Customer specific Config file for OCI API calls. This will have data based on authentication mechanism chosen. | | Public and Private Key Pair | Copied from ```/cd3user/tenancies/keys/```to```/cd3user/tenancies//.config_files``` | API Key for authentication mechanism as API_Key are copied to customer specific out directory locations for easy access. | | GIT Config File | ```/cd3user/tenancies//.config_files/_git_config``` | Customer specific GIT Config file for OCI Dev Ops GIT operations. This is generated only if use_oci_devops_git is set to yes | | S3 Credentials File | ```/cd3user/tenancies//.config_files/_s3_credentials``` | This file contains access key and secret for S3 compatible OS bucket to manage remote terraform state. This is generated only if use_remote_state is set to yes | | Jenkins Home | ```/cd3user/tenancies/jenkins_home``` | This folder contains jenkins specific data. ```Single Jenkins instance can be setup for a single container.```| | tenancyconfig.properties | ```/cd3user/tenancies//.config_files/_tenancyconfig.properties``` | The input properties file used to execute the script is copied to custome folder to retain for future reference. This can be used when the script needs to be re-run with same parameters at later stage.|  <p>The next pages will guide you to use the toolkit either via CLI or via Jenkins. Please proceed further. </p> <p></p>   | :arrow_backward: Prev | Automation Toolkit via CLI :arrow_forward: | Automation Toolkit via Jenkins :arrow_forward: | | :---- | -------: |-------: |"},{"location":"ExcelTemplates/","title":"Excel Sheet Templates","text":"<p>CD3 Excel sheet is the main input for Automation Toolkit.</p> <p>Below are the CD3 templates for the latest release having standardised IAM Components (compartments, groups and policies), Network Components and Events &amp; Notifications Rules as per CIS Foundations Benchmark for Oracle Cloud.</p> <p>Details on how to fill data into the Excel sheet can be found in the Blue section of each sheet inside the Excel file. Make appropriate changes to the templates eg region and use for deployment.</p> <p></p> <p>CD3 Excel templates for OCI core services:</p> Excel Sheet Purpose CD3-Blank-template.xlsx Choose this template while exporting the existing resources from OCI into the CD3 and Terraform. CD3-CIS-template.xlsx This template has auto-filled in data of CIS Landing Zone for DRGv2. Choose this template to create Core OCI Objects (IAM, Tags, Networking, Instances, LBR, Storage, Databases) CD3-HubSpoke-template This template has auto-filled in data for a Hub and Spoke model of networking. Choose this template to create Core OCI Objects (IAM, Tags, Networking, Instances, LBR, Storage, Databases) CD3-SingleVCN-template This template has auto-filled in data for a Single VCN model of networking. Choose this template to create Core OCI Objects (IAM, Tags, Networking, Instances, LBR, Storage, Databases) <p></p> <p>CD3 Excel template for OCI Management services:</p> Excel Sheet Purpose CD3-CIS-ManagementServices-template.xlsx This template has auto-filled in data of CIS Landing Zone. Choose this template while creating the components of Events, Alarms, Notifications and Service Connectors <p></p> <p>The Excel Templates can also be found at /cd3user/oci_tools/cd3_automation_toolkit/example inside the container. After deploying the infra using any of the templates, please run CIS compliance checker script)</p>"},{"location":"FAQ/","title":"Frequently Asked Questions","text":"<p>1. Is there a way to verify my input CD3 Excel sheet for any typos/miskates?         Yes, please choose 'Validate CD3' option in setUpOCI menu in GreenField workflow. It validates specific tabs of the excel sheet. Please see        CD3 Validator Features for more          details.</p> <p>2. Can I use an existing outdir to export the data from OCI? </p> <p>Make sure to use a clean outdir without any .tfvars or .tfstate file. Also use a blank CD3 Excel sheet as export process will overwrite the data in the    respective tab.</p> <p>3. If I am already using the toolkit and my OCI tenancy has been subscribed to a new region, how do i use the new region with toolkit?  Re-run createTenancyConfig.py with same details in tenancyConfig.properties file. It will keep existing region directories as is and create new directory for newly subscribed region.</p> <p>4. How do I upgrade an existing version of the toolkit to the new one without disrupting my existing tenancy files/directories?  Please look at Steps to Upgrade Your Toolkit.</p> <p>5. How do I export instances in batches using different filters?  Follow below steps:           - Modify the setUpOCI.properties file to set non_gf_tenancy to \"true\".           - Choose \"Export Compute\".           - Specify the filter - prefix of the instances or specific AD to export.           - Once the execution completes, take a backup of the files generated for instances in out directory( __instances.tfvars and tf_import_cmds _instances_nonGF.sh) and a backup of the 'Instances' tab of the Input CD3 Excel Sheet.           - Repeat steps from 1 to 4 to export next set of Instances using another filter.           - Once you export all the required instances using multiple filters, move the files from backup to the out directory and then execute all the shell scripts generated for Instances. Consolidate the data of exported instances from the Excel sheet backups. <p>6. How do I delete a compartment from OCI using the toolkit? </p> <p>Terraform destroy on compartments or removing the compartments details from _compartments.auto.tfvars will not delete them from OCI Console by default. Inorder to destroy them from OCI either -             - Add an additional column - enable_delete to Compartments Tab of CD3 Excel sheet with the value TRUE for the compartments that needs to be deleted on terraform destroy. Execute the toolkit menu option to Create Compartments. (OR)            - Add enable_delete = true parameter to each of the compartment that needs to be deleted in _compartments.auto.tfvars <p>7. I am getting 'Permission Denied' error while executing any commands inside the container. </p> <p>When you are running the docker container from a Linux OS, if the outdir is on the root, you may get a permission denied error while executing steps like createAPIKey.py. In such scenarios, please follow the steps given below - Error Screenshot:</p> <p> Solution:</p> <p>Please change:            - selinux mode from Enforcing to Permissive            - change the owner of folders in /cd3user/tenancies to that of cd3user.  Please refer the screenshots below -             - Alternately, please attach a data disk and map the container (/cd3user/tenancies) on a folder that is created on the data disk (your local folder).</p>"},{"location":"GF-Jenkins/","title":"Provisioning of Instances/OKE/SDDC/Database on OCI via Jenkins","text":"<p>To provision OCI resources which require input ssh keys and source image details, update variables_\\&lt;region&gt;.tf file using CLI.</p> <p>Step 1:   Update required data in <code>/cd3user/tenancies/&lt;customer_name&gt;/terraform_files/&lt;region&gt;/&lt;service_dir&gt;/variables_&lt;region&gt;.tf</code>.</p> <p>Step 2:  Execute GIT commands to sync these local changes with DevOps GIT Repo. Here are the steps.</p> <p>Step 3:   Execute setUpOCI pipeline from Jenkins dashboard with workflow type as Create Resources in OCI(Greenfield Workflow) and choose the respective options to create required services.</p> <p></p>   | :arrow_backward: Prev | Next :arrow_forward: | | :---- | -------: |"},{"location":"GreenField-Jenkins/","title":"Create resources in OCI via Jenkins(Greenfield Workflow)","text":""},{"location":"GreenField-Jenkins/#execute-setupoci-pipeline","title":"Execute setUpOCI Pipeline","text":"<p>Step 1:  Choose the appropriate CD3 Excel sheet template from Excel Templates. Fill the CD3 Excel with appropriate values.</p> <p>Step 2: Login to Jenkins URL with the user created after initialization and click on setUpOCI pipeline from Dashboard. Click on 'Build with Parameters' from left side menu.</p> <p></p> <p>Note - Only one user at a time using the Jenkins setup is supported in the current release of the toolkit.</p> <p>Step 3: Upload the above filled Excel sheet in Excel_Template section.</p> <p></p> <p>This will copy the Excel file at <code>/cd3user/tenancies/&lt;customer_name&gt;</code> inside the container. It will also take backup of existing Excel on the container by appending the current datetime if same filename is uploaded in multiple executions.</p> <p>Step 4: Select the workflow as Create Resources in OCI(Greenfield Workflow). Choose single or multiple MainOptions as required and then corresponding SubOptions.  Please read while selcting multiple options simultaneously. Below screenshot shows creation of Compartments (under Identity) and Tags.</p> <p></p> <p>Click on Build at the bottom.</p> <p>Step 5: setUpOCI pipeline is triggered and stages are executed as shown below. This will run the python script to generate the terraform auto.tfvars.  Once created, it will commit to the OCI Devops GIT Repo and then it will also launch terraform-apply pipelines for the services chosen (Stage:phoenix/identity and Stage:phoenix/tagging in the below screenshot).</p> <p></p>"},{"location":"GreenField-Jenkins/#execute-terraform-pipelines","title":"Execute terraform Pipelines","text":"<p>Terraform pipelines are auto triggered parallely from setUpOCI pipeline based on the services selected (the last two stages in above screenshot show trigger of terraform pipelines). </p> <p>Step 1: </p> <p>Click on 'Logs' for Stage: phoenix/identity and click on the pipeline link. </p> <p>Note - Navigating to Dashboard displays pipelines that are in running state at the bottom left corner. Or you can also navigate from Dashboard using the region based view (Dashboard -&gt; phoenix View -&gt; service specific pipeline) in this example it would be: terraform_files \u00bb phoenix \u00bb tagging \u00bb terraform-apply terraform_files \u00bb phoenix \u00bb identity \u00bb terraform-apply </p> <p>Step 2:  Stages of the terraform pipeline for apply are shown below:</p> <p></p> <p>Step 3: Review Logs for Terraform Plan and OPA stages by clicking on the stage and then 'Logs'. </p> <p></p> <p>Step 4:  'Get Approval' stage has timeout of 24 hours, if no action is taken the pipeline will be aborted after 24 hours. Click on this stage and click 'Proceed' to proceed with terraform apply or 'Abort' to cancel the terraform apply.</p> <p></p> <p>Step 5: Below screenshot shows Stage View after clicking on 'Proceed'. Login to the OCI console and verify that resources got created as required.</p> <p></p> <p>Step 6: Similarly click on 'Logs' for Stage: phoenix/tagging and click on the pipeline link and 'Proceed' or 'Abort' the terraform apply</p> <p></p>   | :arrow_backward: Prev | Next :arrow_forward: | | :---- | -------: |"},{"location":"GreenField/","title":"Create resources in OCI (Greenfield Workflow)","text":"<p>Step 1:  Choose the appropriate Excel sheet template from Excel Templates</p> <p>Step 2: Fill the Excel with appropriate values and put at the appropriate location. Modify/Review /cd3user/tenancies//_setUpOCI.properties with workflow_type set to create_resources as shown below: <pre><code>#Input variables required to run setUpOCI script\n\n#path to output directory where terraform file will be generated. eg /cd3user/tenancies/&lt;customer_name&gt;/terraform_files\noutdir=/cd3user/tenancies/demotenancy/terraform_files/\n\n#prefix for output terraform files eg &lt;customer_name&gt; like demotenancy\nprefix=demotenancy\n\n# auth mechanism for OCI APIs - api_key,instance_principal,session_token\nauth_mechanism=api_key\n\n#input config file for Python API communication with OCI eg /cd3user/tenancies/&lt;customer_name&gt;/.config_files/&lt;customer_name&gt;_config;\nconfig_file=/cd3user/tenancies/demotenancy/.config_files/demotenancy_oci_config\n\n# Leave it blank if you want single outdir or specify outdir_structure_file.properties containing directory structure for OCI services.\noutdir_structure_file=/cd3user/tenancies/demotenancy/demotenancy_outdir_structure_file.properties\n\n#path to cd3 excel eg /cd3user/tenancies/&lt;customer_name&gt;/CD3-Customer.xlsx\ncd3file=/cd3user/tenancies/demotenancy/CD3-Blank-template.xlsx\n\n#specify create_resources to create new resources in OCI(greenfield workflow)\n#specify export_resources to export resources from OCI(non-greenfield workflow)\nworkflow_type=create_resources\n</code></pre> <p>Step 3: Execute the SetUpOCI.py script to start creating the terraform configuration files.</p> <p>Command to Execute: <code>cd /cd3user/oci_tools/cd3_automation_toolkit/</code> python setUpOCI.py  ie <code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code> <p>\u2192 Example execution of the wrapper script:</p> <p></p> <p>Choose the resources by specifying a single option (for choosing one of these resources) or comma-separated values (to choose multiple resources) as shown in the sample screenshot above.</p> <p>Step 4: Change your directory to /cd3user/tenancies//terraform_files//  and Execute: <p>terraform init  - To initialize and prepare your working/out directory soTerraform can run the configuration.</p> <p>terraform plan  - To preview any changes before you apply them. Run the plan against OPA policies for compliance against CIS.</p> <p>terraform apply - To make the changes defined by Terraform configuration to create, update, or destroy resources in OCI.</p> <p>Note </p> <p>Execute \"Fetch Compartments OCIDs to variables file\" from CD3 Services in setUpOCI menu after you create Compartments. This is a required step everytime you create a compartment via toolkit or via the OCI console.</p> <p></p> <p>## Example - Create a Compartment</p> <p>Follow the below steps to quickly provision a compartment on OCI.</p> <ol> <li>Use the excel CD3-SingleVCN-template and fill the required Compartment details in the 'Compartments' tab.</li> </ol> <p>Make appropriate changes to the template. For Eg: Update the Region value to your tenancy's home region.</p> <p>Once all the required data is filled in the Excel sheet, place it at the location /cd3user/tenancies// which is also mapped to your    local directory. <ol> <li>Edit the setUpOCI.properties at location:/cd3user/tenancies //_setUpOCI.properties with appropriate values.  <li>Update the cd3file parameter to specify the CD3 excel sheet path.</li> <li> <p>Set the workflow_type parameter value to create_resources. (for Greenfield Workflow.)</p> </li> <li> <p>Change Directory to 'cd3_automation_toolkit' :     <code>cd /cd3user/oci_tools/cd3_automation_toolkit/</code></p> </li> <p>and execute the setupOCI.py file:</p> <p><code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code></p> <ol> <li>Choose option to create compartments under 'Identity' from the displayed menu. Once the execution is successful, _compartments.auto.tfvars file will be generated under the folder /cd3user/tenancies//terraform_files// <p>Navigate to the above path and execute the terraform commands: terraform init terraform plan terraform apply</p> <ol> <li> <p>Choose Fetch Compartments OCIDs to variables file under CD3 Services in setUpOCI menu. Execute the command to fetch the details of the                 compartments if it already exists/ created in OCI. These details will be written to the terraform variables file.</p> </li> <li> <p>Repeat the above process (except Step 5) to create other components in OCI.</p> </li> </ol> <p></p>   | :arrow_backward: Prev | Next :arrow_forward: | | :---- | -------: |"},{"location":"Intro-Jenkins/","title":"Introduction to Jenkins with the toolkit","text":""},{"location":"Intro-Jenkins/#introduction-to-jenkins-with-the-toolkit","title":"Introduction to Jenkins with the toolkit","text":""},{"location":"Intro-Jenkins/#jenkins-dashbord","title":"Jenkins Dashbord","text":"<ol> <li>setUpOCI Pipeline</li> <li>terraform_files Folder</li> <li>Region based Views (including Global directory)</li> </ol>"},{"location":"Intro-Jenkins/#1-setupoci-pipeline","title":"1. setUpOCI Pipeline","text":"<p>This is equivalent to running setUpOCI.py from CLI. This will generate the terraform .auto.tfvars files based on the CD3 Excel sheet input for the services chosen and commit them to OCI Devops GIT repo. This will also trigger terraform-apply pipelines for the corresponding services chosen in setUpOCI pipeline.</p> <p>Below table shows the stages executed in this pipeline along with their description:</p> <p></p> Expand this to view setUpOCI Pipeline Stages   |Stage Name      | Description  | Possible Outcomes | | --------------- | ------------ | ----------------- | | Validate Input Parameters | Validates input file name/size, selected parameters | Displays Unstable if any of the validation fails. Pipeline stops further execution in that case. | | Update setUpOCI.properties | Updates _setUpOCI.properties with input filename and workflow_type | Displays Failed if any issue during execution | | Execute setUpOCI | Executes python code to generate required tfvars files. The console output for this stage is similar to setUpOCI.py execution via CLI. Multiple options selected will be processed sequentially in this stage. | Displays Failed if any issue occurs during its execution. Further stages are skipped in that case. | | Run Import Commands | Based on the workflow_type as 'Export Resources from OCI', this stage invokes execution of tf_import_commands_\\_nonGF.sh shell scripts which will import the exported objects into tfstate. tf_import_commands for multiple options selected will be processed sequentially in this stage.  This stage is skipped for 'Create Resources in OCI' workflow | Displays Failed if any issue occurs during its execution. Further stages are skipped in that case. | | Git Commit | Commits the terraform_files folder to OCI DevOps GIT Repo. This will trigger respective terraform_pipelines| Pipeline stops further execution if there is nothing to commit. In some cases when tfvars was generated in previous execution, you can navigate to terrafom-apply pipeline and trigger that manually | | Trigger Terraform Pipelines | Corresponding terraform apply pipelines are auto triggered based on the service chosen | |  <p></p>"},{"location":"Intro-Jenkins/#2-terraform_files-folder","title":"2. terraform_files Folder","text":"<p>This is equivalent to /cd3user/tenancies//terraform_files folder on your local system. The region directories along with all service directories, are present under this terraform_files folder. The toolkit will generate the .tfvars files for all resources under the service directory. Inside each service directory, pipelines for terraform-apply and terraform-destroy are present. <p>The terraform pipelines are either triggered automatically from setUpOCI pipeline or they can be triggered manually by navigating to any service directory path.</p> <p></p> Expand this to view terraform-apply Pipeline Stages   |Stage Name      | Description  | Possible Outcomes | | --------------- | ------------ | ----------------- | | Checkout SCM | Checks out the latest terraform_files folder from DevOps GIT repo | | | Terraform Plan | Runs terraform plan against the checked out code and saves it in tfplan.out | Pipeline stops further execution if terraform plan shows no changes. Displays Failed if any issue while executing terraform plan | | OPA | Runs the above genrated terraform plan against Open Policies and displays the violations if any | Displays Unstable if any OPA rule is violated | | Get Approval | Approval Stage for reviewing the terraform plan. There is 24 hours timeout for this stage. | Proceed - goes ahead with Terraform Apply stage.  Abort - pipeline is aborted and stops furter execution | |Terraform Apply | Applies the terraform configurations | Displays Failed if any issue while executing terraform apply |  <p></p> Expand this to view terraform-destroy Pipeline Stages  |Stage Name      | Description  | Possible Outcomes | | --------------- | ------------ | ----------------- | | Checkout SCM | Checks out the latest terraform_files folder from DevOps GIT repo | | | Terraform Destroy Plan | Runs `terraform plan -destroy` against the checked out code | Displays Failed if any issue in plan output | | Get Approval | Approval Stage for reviewing the terraform plan. There is 24 hours timeout for this stage. | Proceed - goes ahead with Terraform Destroy stage.  Abort - pipeline is aborted and stops furter execution | |Terraform Destroy | Destroys the terraform configurations | Displays Failed if any issue while executing terraform destroy |  <p></p>"},{"location":"Intro-Jenkins/#3-region-based-views","title":"3. Region Based Views","text":"<p>When you click on any of the views, it displays all terraform-apply and terraform-destroy pipelines in single screen. This can also be used to trigger the terraform pipelines. This also includes Global view for global services like RPC.</p> <p></p>   | :arrow_backward: Prev | Next :arrow_forward: | | :---- | -------: |"},{"location":"Jobs_Migration/","title":"Migrate Jobs from Automation Toolkit Jenkins to Customer Jenkins Environment","text":"<ol> <li> <p>Copy Jobs Folder</p> <ul> <li>Copy the folders from the Automation Toolkit Jenkins home path <code>/cd3user/tenancies/jenkins_home/jobs/</code> to the corresponding home directory in the Customer Jenkins instance (typically <code>/var/jenkins_home</code>).</li> </ul> <p></p> </li> <li> <p>Set up OCI Devops repository SSH Authentication</p> <ul> <li>Ensure SSH authentication is configured and operational on the Customer Jenkins instance. For detailed instructions, refer to the OCI Code Repository documentation.</li> </ul> <p>Note - Steps to change the GIT repo are explained in next section.</p> </li> <li> <p>Ensure Availability of Ansi Color Plugin</p> <ul> <li>Confirm the presence of the Ansi color plugin in the Customer Jenkins instance. This plugin is utilized in Automation Toolkit pipeline Groovy code and is necessary if not already installed. Plugin link: Ansicolor Plugin</li> </ul> </li> <li> <p>Install Terraform Binary</p> <ul> <li>Make sure the Terraform binary is installed and accessible for the Jenkins user within the Jenkins instance. Installation guide: Terraform Installation</li> </ul> </li> <li> <p>Update Optional Attribute Field inside Terraform Provider Block at <code>/cd3user/tenancies/&lt;customer_name&gt;/terraform_files/&lt;region&gt;&lt;service_dir&gt;/provider.tf</code></p> <ul> <li>Include an  attribute as highlighted below within the Terraform provider block. This is optional but necessary in case Terraform plan encounters an error.<pre><code>  experiments = [module_variable_optional_attrs]\n</code></pre> </li> </ul> <p></p> </li> <li> <p>Update the correct value for private_key_path variable in <code>/cd3user/tenancies/&lt;customer_name&gt;/terraform_files/&lt;region&gt;&lt;service_dir&gt;/variables_&lt;region&gt;.tf</code></p> </li> <li> <p>Configure S3 Backend Credentials in Customer Jenkins Instance</p> <ul> <li>Update the correct path within the <code>backend.tf</code> file for Terraform.</li> </ul> <p></p> </li> <li> <p>Push the above changes to Devops GIT repository so that pipline can get the latest commits/changes and execute it.</p> </li> <li> <p>Stop/Start the Customer Jenkins Instance for the changes to take effect. This is applicable for any configuration changes in Jenkins.</p> </li> <li> <p>Job and Pipeline Configuration</p> <ul> <li>Verify that the specified jobs and pipelines, initialized by the Automation Toolkit, are visible in the Customer Jenkins instance.</li> </ul> <p></p> </li> <li> <p>Pipeline Job Output</p> <p></p> </li> </ol>"},{"location":"Jobs_Migration/#update-the-git-url-for-all-pipeline-jobs-in-the-customer-jenkinsif-required","title":"Update the Git URL for all pipeline jobs in the Customer Jenkins(if required).","text":"<ol> <li>Remove terraform_files folder under /jobs folder <li> <p>Create <code>jenkins.properties</code> File</p> <ul> <li> <p>Copy the <code>jenkins.properties</code> file from Automation Toolkit Jenkins home folder <code>/cd3users/tenancies/jenkins_home/</code> to the customer jenkins home (typically <code>/var/jenkins_home/</code>) directory in customer Jenkins Instance (Below is sample content):</p> <p>git_url= \"ssh://devops.scmservice.us-phoenix-1.oci.oraclecloud.com/namespaces//projects/toolkitdemo-automation-toolkit-project/repositories/toolkitdemo-automation-toolkit-repo\"   regions=['london', 'phoenix']   services=['identity', 'tagging', 'network', 'loadbalancer', 'vlan', 'nsg', 'compute', 'database', 'fss', 'oke', 'ocvs', 'security', 'managementservices', 'budget', 'cis', 'oss', 'dns']   outdir_structure=[\"Multiple_Outdir\"] <li> <p>Update the <code>git_url</code> in the <code>jenkins.properties</code> File</p> <ul> <li>Open the <code>jenkins.properties</code> file located in the <code>/var/jenkins_home/</code> directory.</li> <li>Update the <code>git_url</code> in the file with the new Git server URL.</li> </ul> <p></p> </li> <li> <p>Copy <code>01_jenkins-config.groovy</code> File</p> <ul> <li>Copy the <code>01_jenkins-config.groovy</code> file from the Automation Toolkit Jenkins path (<code>/cd3user/tenancies/jenkins_home/init.groovy.d</code>) to the init path of the Customer Jenkins instance.</li> <li>Update the path to the groovy file accordingly.</li> </ul> <p></p> </li> <li> <p>Restart Customer Jenkins Instance</p> <ul> <li>Stop and start the Customer Jenkins instance to apply the changes.</li> <li>After that, all Git URLs will be updated and point to new Git Url inside pipeline jobs.</li> </ul> <p></p> </li> <li> <p>Ensure SSH Authentication</p> <ul> <li>Confirm that SSH authentication is enabled for the new GIT repository from the Jenkins instance.</li> <li>Alternatively, use the respective authentication method if relying on other methods.</li> </ul> </li>"},{"location":"KnownBehaviour/","title":"Expected Behaviour Of Automation Toolkit","text":"<p>Note</p> <pre><code>1. Automation Tool Kit DOES NOT support the creation/export of duplicate resources.\n2. Automation Tool Kit DOES NOT support sharing of Block Volumes.\n</code></pre> <p>Warning</p> <pre><code>   1. DO NOT modify/remove any commented rows or column names. You may re-arrange the columns if needed.\n   2. A double colon (::) or Semi-Colon (;) has a special meaning in the Tool Kit. Do not use them in the OCI data / values.\n   3. Do not include any unwanted space in cells you fill in; do not place any empty rows in between.\n   4. Any entry made/moved post \\&lt;END&gt; in any of the tabs of CD3 will not be processed. Any resources created by the automation &amp; then moved after the \\&lt;END&gt; will cause the resources to be removed.\n</code></pre> <p>Important</p> <pre><code>      The components that get created as part of VCNs Tab (Example: IGW, SGW, LPG, NGW, DRG) will have the same set of Tags attached to them.&lt;br&gt;\n      Some points to consider while modifying networking components are:\n      1. Converting the exported VCN to Hub/Spoke/Peer VCN is not allowed. Route Table rules based on the peering for new LPGs to existing VCNs will not be auto populated. Users are requested to add an entry to the RouteRulesInOCI sheet to support the peering rules.\n      2. Adding a new VCN as Hub and other new VCNs as Spoke/Peer is allowed. Gateways will be created as specified in VCNs sheet.\n      3. Adding new VCNs as None is allowed. Gateways will be created as specified in VCNs sheet.\n      4. The addition of new Subnets to exported VCNs and new VCNs is allowed.\n      5. You might come across below error during export of NSGs(while runnig terraform import commands for NSGs). It occurs when NSG and the VCN are in different compartments. In such cases, please modify \\&lt;customer_name\\&gt;_nsgs.auto.tfvars, specify the compartment name of the VCN in network_compartment_id field of the problematic NSG.\n</code></pre> <p>            6. When you have exported Identity and Network services together in single outdirectory for the first time and executing identity import script. You might see import failure with below error message. Execute Major network import script first then run Identity import script. </p> <pre><code>    !!!!!!!!!!!!!!!!!!!!!!!!!!! TERRAFORM CRASH !!!!!!!!!!!!!!!!!!!!!!!!!!!!\n    4 problems:\n    - Failed to serialize resource instance in state: Instance data.oci_core_drg_route_distributions.drg_route_distributions[\"DRG-ASH_Autogenerated-Import-Route-Distribution-for-ALL-routes\"] has status ObjectPlanned, which cannot be saved in state.\n    - Failed to serialize resource instance in state: Instance data.oci_core_drg_route_distributions.drg_route_distributions[\"DRG-ASH_Autogenerated-Import-Route-Distribution-for-VCN-Routes\"] has status ObjectPlanned, which cannot be saved in state.\n</code></pre>"},{"location":"KnownBehaviour/#terraform-behavior","title":"Terraform Behavior","text":""},{"location":"KnownBehaviour/#1create-a-load-balancer-with-reserved-ip-when-you-create-a-lbaas-with-reserved-ip-as-y-and-do-a-terraform-apply-everything-will-go-smooth-and-be-in-sync-for-the-first-time-if-you-do-a-terraform-plan-immediately-post-apply-you-will-find-that-the-plan-changes-the-private-ip-of-load-balancer-to-null","title":"1.Create a Load Balancer with Reserved IP: When you create a LBaaS with reserved ip as \"Y\" and do a terraform apply, everything will go smooth and be in sync for the first time. If you do a terraform plan immediately (post apply), you will find that the plan changes the private ip of load balancer to null.","text":"<p>This is a behaviour of Terraform.  In these scenarios, please add the private ip ocid to the auto.tfvars as shown below before you run a terraform plan again.</p> <p></p> <p>Once you do the above change, and then execute a terraform plan/apply, you will get the below error and it can be ignored.</p> <p></p>"},{"location":"KnownBehaviour/#2-while-exporting-and-synching-the-tfstate-file-for-lbaas-objects-the-user-may-be-notified-that-a-few-components-will-be-modified-on-apply-in-such-scenarios-add-the-attributes-that-the-terraform-notifies-to-be-changed-to-the-appropriate-cd3-tab-of-load-balancer-and-uncomment-the-parameter-from-jinja2-templates-and-terraform-tf-files-re-run-the-export","title":"2. While exporting and synching the tfstate file for LBaaS Objects, the user may be notified that a few components will be modified on apply. In such scenarios, add the attributes that the Terraform notifies to be changed to the appropriate CD3 Tab of Load Balancer and uncomment the parameter from Jinja2 Templates and Terraform (.tf) files. Re-run the export.","text":""},{"location":"KnownBehaviour/#3-add-a-new-column-freeform-tags-to-the-cd3-excel-sheets-as-per-necessity-to-export-the-tags-associated-with-the-resource-as-well-if-executed-as-is-terraform-may-prompt-you-to-modify-resources-based-on-tags","title":"3. Add a new column - \"Freeform Tags\" to the CD3 Excel Sheets as per necessity, to export the tags associated with the resource as well. If executed as-is, Terraform may prompt you to modify resources based on Tags.","text":"<p>Example:</p> <p></p>"},{"location":"KnownBehaviour/#4-toolkit-will-create-tf-for-only-those-drgs-which-are-part-of-cd3-and-skip-route-tables-for-the-drgs-created-outside-of-cd3-this-will-also-synch-drg-rules-in-your-tenancy-with-the-terraform-state","title":"4. Toolkit will create TF for only those DRGs which are part of CD3 and skip Route Tables for the DRGs created outside of CD3. This will also synch DRG rules in your tenancy with the terraform state.","text":"<p>Note When there are changes made in the OCI console manually, the above options of export and modify can be helpful to sync up the contents/objects in OCI to TF.</p>"},{"location":"KnownBehaviour/#5-match-all-criteria-specified-for-route-distribution-statement-in-drgs-sheet-will-show-below-output-each-time-you-do-terraform-plan","title":"5. Match All criteria specified for Route Distribution Statement In DRGs sheet will show below output each time you do terraform plan:","text":"<p>The service api is designed in such a way that it expects an empty list for match all. And it sends back an empty list in the response every time. Hence this behaviour from terraform side. This can be safely ignored.</p>"},{"location":"KnownBehaviour/#6-export-process-for-non-greenfield-tenancies-v60-or-higher-will-try-to-revert-sgw-for-a-vcn-to-point-to-all-services-if-it-was-existing-for-just-object-storage-you-will-get-output-similiar-to-below-when-terraform-plan-is-run-option-3-with-workflow_type-set-to-export_resources","title":"6. Export process for non greenfield tenancies v6.0 or higher will try to revert SGW for a VCN to point to all services if it was existing for just object storage. You will get output similiar to below when terraform plan is run (Option 3 with workflow_type set to export_resources).","text":"<pre><code># oci_core_service_gateway.VCN_sgw will be updated in-place\n\n~ resource \"oci_core_service_gateway\" \"VCN_sgw\" {\n\n      block_traffic  = false\n\n      compartment_id = \"ocid1.compartment.oc1..aaaaaaaahsesjfw5hhftccsvndbufdlf5ca2c3q3clyvwg4wngj4ej26i3ya\"\n\n      display_name   = \"VCN_sgw\"\n      freeform_tags  = {}\n\n      id             = \"ocid1.servicegateway.oc1.iad.aaaaaaaajqtpjqy7ihgikmug5kbz55pztymt7m6t4ijlqek5ujqg3qxeaxma\"\n\n      state          = \"AVAILABLE\"\n\n      time_created   = \"2019-03-19 16:46:33.859 +0000 UTC\"\n\n      vcn_id         = \"ocid1.vcn.oc1.iad.aaaaaaaazjup6ahpesjgrjyaxr2bcnx44tpn3ygvx2tjylytgkub5ikl6rha\"\n\n\n    - services {\n\n        - service_id   = \"ocid1.service.oc1.iad.aaaaaaaa74z6sqsezqf6znyomdp5jkvfwb4j2ol33abgosvnhxcqphyl3eaq\" -&gt; null\n\n        - service_name = \"OCI IAD Object Storage\" -&gt; null\n\n      }\n\n    + services {\n\n        + service_id   = \"ocid1.service.oc1.iad.aaaaaaaam4zfmy2rjue6fmglumm3czgisxzrnvrwqeodtztg7hwa272mlfna\"\n\n        + service_name = (known after apply)\n\n      }\n\n      timeouts {}\n\n  }\n</code></pre>"},{"location":"KnownBehaviour/#7-if-the-description-field-is-having-any-newlines-in-the-tenancy-then-the-export-of-the-component-and-tf-synch-will-show-output-similair-to-below","title":"7. If the description field is having any newlines in the tenancy then the export of the component and tf synch will show output similair to below:","text":"<pre><code># module.iam-policies[\u201cConnectorPolicy_notifications_2023-03-06T21-54-41-655Z\u201d].oci_identity_policy.policy will be updated in-place\n~ resource \u201coci_identity_policy\u201d \u201cpolicy\u201d {\n ~ description  = &lt;&lt;-**EOT**\n    This policy is created for the \u2018OCI_To_Sentinel\u2019 service connector\n    Date: Mon, 06 Mar 2023 21:54:41 GMT\n    User: oracleidentitycloudservice/abc@oracle.com\n    Tenant: test\n    Connection Source: notifications\n  **EOT**\n  id       = \u201cocid1.policy.oc1..aaaaaaaa5gct2n6vz4arggmeow27rivu5vro6jjb6ccuq5u2phulghgwx\u201d\n  name      = \u201cConnectorPolicy_notifications_2023-03-06T21.54.41.655Z\u201d\n  # (9 unchanged attributes hidden)\n  # (1 unchanged block hidden)\n}\nPlan: 0 to add, 1 to change, 0 to destroy.\n</code></pre> <p>This is how terraform handles newlines in the fields. Pleage ignore this and proceed with terraform apply.</p>"},{"location":"KnownBehaviour/#8-terraform-ordering-changes-observed-during-plan-phase-for-oci-compute-plugins","title":"8. Terraform ordering changes observed during plan phase for OCI compute plugins.","text":"<p>It changes the order of plugin's in terraform state file and doesn't change anything in OCI console for compute resource.</p>"},{"location":"Launch_Docker_container/","title":"Launch the Container","text":"<p>To ease the execution of toolkit, we have provided the steps to build an image which encloses the code base and its package dependencies. Follow the steps provided below  to clone the repo, build the image and finally launch the container. </p>"},{"location":"Launch_Docker_container/#clone-the-repo","title":"Clone the repo","text":"<ul> <li>Open your terminal and navigate to the directory where you plan to download the Git repo.</li> <li>Run the git clone command as shown below: <code>git clone https://github.com/oracle-devrel/cd3-automation-toolkit</code></li> <li>Once the cloning command is executed successfully, the repo will replicate to the local directory. </li> </ul>"},{"location":"Launch_Docker_container/#build-an-image","title":"Build an image","text":"<ul> <li>Change directory to 'cd3-automation-toolkit'(i.e. the cloned repo in your local).</li> <li>Run <code>docker build --platform linux/amd64 -t cd3toolkit:${image_tag} -f Dockerfile --pull --no-cache .</code> Note : ${image_tag} should be replaced with suitable tag as per your requirements/standards. eg v2024.1.0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0The period (.) at the end of the docker build command is required.</li> </ul>"},{"location":"Launch_Docker_container/#save-the-image-optional","title":"Save the image (Optional)","text":"<ul> <li>Run  <code>docker save cd3toolkit:${image_tag} | gzip &gt; cd3toolkit_${image_tag}.tar.gz</code></li> </ul>"},{"location":"Launch_Docker_container/#run-the-container-alongwith-vpn-applicable-for-vpn-users-only","title":"Run the container alongwith VPN (Applicable for VPN users only)","text":"<ul> <li>Connect to the VPN.</li> <li>Make sure you are using version 1.9 for Rancher deskop, if not please install the latest.</li> <li> <p>Make sure to Enable Networking Tunnel under Rancher settings as shown in the screenshot below,</p> <p></p> </li> <li> <p>Login to the CD3 docker container using next section and set the proxies(if any) which helps to connect internet from the container.</p> </li> </ul>"},{"location":"Launch_Docker_container/#run-the-container","title":"Run the container","text":"<ul> <li>Run  <code>docker run --platform linux/amd64 -it -p &lt;port_number_in_local_system&gt;:8443 -d -v &lt;directory_in_local_system_where_the_files_must_be_generated&gt;:/cd3user/tenancies &lt;image_name&gt;:&lt;image_tag&gt;</code></li> </ul> <p>Eg for Mac: <code>docker run --platform linux/amd64 -it -p 8443:8443 -d -v /Users/&lt;user_name&gt;/mount_path:/cd3user/tenancies cd3toolkit:v2024.1.0</code></p> <p>Eg for Windows: <code>docker run --platform linux/amd64 -it -p 8443:8443 -d -v D:/mount_path:/cd3user/tenancies cd3toolkit:v2024.1.0</code></p> <p>If you are launching the container on cloud, Please make sure to use a private server or a bastion connected server with restricted access(i.e. not publicly available) to host the container.</p> <ul> <li>Run  <code>docker ps</code></li> </ul> <p></p>   | :arrow_backward: Prev | Next :arrow_forward: | | :---- | -------: |"},{"location":"LearningVideos/","title":"Automation Toolkit Learning Videos","text":"<ul> <li>CD3 Automation Toolkit Explained in 1 minute</li> <li>Part 1- Introduction to CD3 Automation Toolkit</li> <li>Part 2 - How to Install and Configure Rancher Desktop with CD3</li> <li>Part 3 - How to Create the Image and Run the Container with CD3</li> <li>Part 4 - Connect CD3 Automation toolkit container to OCI tenancy</li> <li>Part 5 - How to use CD3 Excel Sheets</li> <li>Part 6 - Execute the CD3 Automation toolkit using CLI to create resources in OCI</li> <li>Part 7 - Execute CD3 Automation Toolkit using CLI to export resources in OCI</li> <li>Part 8 - Execute the CD3 Automation toolkit using Jenkins to create resources in OCI</li> <li>Part 9 - Execute the CD3 Automation toolkit using Jenkins to export resources from OCI</li> <li>Part 10 - Support for Additional Attributes - CD3 Automation toolkit</li> <li>Configuring OCI Private DNS using CD3</li> <li>Provisioning OCI Object storage Buckets using CD3</li> </ul> <p>Here is the Youtube playlist link for all these videos.</p>"},{"location":"NetworkingScenariosGF-Jenkins/","title":"Executing Networking Scenarios using toolkit via Jenkins","text":""},{"location":"NetworkingScenariosGF-Jenkins/#managing-network-for-greenfield-workflow","title":"Managing Network for Greenfield Workflow","text":"<ul> <li>Create Network</li> <li>Modify Network</li> <li>Modify Security Rules, Route Rules and DRG Route Rules</li> <li>Sync manual changes done in OCI of Security Rules, Route Rules and DRG Route Rules with CD3 Excel Sheet and Terraform</li> <li>Add/Modify/Delete NSGs</li> <li>Add/Modify/Delete VLANs</li> <li>Remote Peering Connections</li> </ul> <p>NOTE-</p>"},{"location":"NetworkingScenariosGF-Jenkins/#create-network","title":"Create Network","text":"<p>Creation of Networking components using Automation Toolkit involves four simple steps.  - Add the networking resource details to appropriate Excel Sheets.  - Running the setUpOCI pipeline in the toolkit to generate auto.tfvars.  - Executing terraform pipeline to provision the resources in OCI.  - Exporting the automatically generated Security Rules and Route Rules by the toolkit to CD3 Excel Sheet.</p> <p>Below are the steps to create Network that includes VCNs, Subnets, DHCP, DRG, Security List, Route Tables, DRG Route Tables, NSGs, etc.</p> <ol> <li> <p>Choose appropriate excel sheet from Excel Templates and fill the required Network details in the Networking Tabs - VCNs, DRGs, VCN Info, DHCP, Subnets, NSGs tabs.</p> </li> <li> <p>Execute the setupOCI pipeline with Workflow as Create Resources in OCI(Greenfield Workflow)</p> </li> <li> <p>Choose option 'Validate CD3' and then 'Validate Networks' to check for syntax errors in Excel sheet. Examine the log file generated at /cd3user/tenancies//_cd3validator.log. If there are errors, please rectify them accordingly and proceed to the next step. <li> <p>Choose 'Create Network' under 'Network' from the displayed options. Click on Build. </p> </li> <li> <p>It will show different stages of execution of setUpOCI pipeline and also launch the terraform-apply pipeline for 'network'.</p> </li> <li>Click on Proceed for 'Get Approval' stage of the terraform pipeline.</li> <p>This completes the creation of Networking components in OCI. Verify the components in console. However the details of the default security lists and default route tables are not available in the CD3 Excel sheet yet. Inorder to export that data please follow the below steps:</p> <ol> <li>Execute the setupOCI.py pipeline with Workflow as Create Resources in OCI(Greenfield Workflow)</li> <li>Choose 'Network' from the displayed options. Choose below sub-options: (Make sure to choose all the three optionsfor the first time)</li> <li>Security Rules<ul> <li>Export Security Rules (From OCI into SecRulesinOCI sheet)</li> </ul> </li> <li>Route Rules<ul> <li>Export Route Rules (From OCI into RouteRulesinOCI sheet)</li> </ul> </li> <li>DRG Route Rules<ul> <li>Export DRG Route Rules (From OCI into DRGRouteRulesinOCI sheet) Click on Build.</li> </ul> </li> </ol> <p></p> <p>This completes the steps for Creating the Network in OCI and exporting the default rules to the CD3 Excel Sheet using the Automation Toolkit.</p> <p>Go back to Networking Scenarios</p>"},{"location":"NetworkingScenariosGF-Jenkins/#modify-network","title":"Modify Network","text":"<p>Modifying the Networking components using Automation Toolkit involves three simple steps.  - Add/modify the details of networking components like the VCNs, Subnets, DHCP and DRG in Excel Sheet.  - Running the the setUpOCI pipeline in the toolkit to generate auto.tfvars.  - Executing Terraform pipeline to provision/modify the resources in OCI.</p> <p>Note: Follow these steps to modify Security Rules, Route Rules and DRG Route Rules</p> <p>Steps in detail: 1. Modify your excel sheet to update required data in the Tabs - VCNs, DRGs, VCN Info, DHCP and Subnets. 2. Execute the setupOCI.py pipeline with Workflow as Create Resources in OCI(Greenfield Workflow) 3. To Validate the CD3 excel Tabs - Choose option 'Validate CD3' and 'Validate Networks' from sub-menu to check for syntax errors in Excel sheet. Examine the log file generated at /cd3user/tenancies//_cd3validator.logs. If there are errors, please rectify them accordingly and proceed to the next step. 4. Choose option to 'Modify Network' under 'Network' from the displayed options. Once the execution is successful, multiple .tfvars related to networking like _major-objects.auto.tfvars and more will be generated under the folder /cd3user/tenancies//terraform_files//. Existing files will move into respective backup folders. <p>Note-: Make sure to export Sec Rules, Route Rules, DRG Route Rules to CD3 Excel Sheet before executing this option.</p> <ol> <li>It will show different stages of execution of setUpOCI pipeline and also launch the terraform-apply pipeline for 'network'.</li> <li>Click on Proceed for 'Get Approval' stage of the terraform pipeline.</li> </ol> <p>This completes the modification of Networking components in OCI. Verify the components in console.</p> <p>Go back to Networking Scenarios</p>"},{"location":"NetworkingScenariosGF-Jenkins/#modify-security-rules-route-rules-and-drg-route-rules","title":"Modify Security Rules, Route Rules and DRG Route Rules","text":"<p>Follow the below steps to add, update or delete the following components: - Security Lists and Security Rules - Route Table and Route Rules - DRG Route Table and DRG Route Rules</p> <ol> <li> <p>Modify your excel sheet to update required data in the Tabs - RouteRulesInOCI, SecRulesInOCI, DRGRouteRulesInOCI tabs.</p> </li> <li> <p>Execute the setupOCI.py pipeline with Workflow as Create Resources in OCI(Greenfield Workflow)</p> </li> <li> <p>Choose 'Network' from the displayed options. Choose below sub-options:</p> </li> <li>Security Rules<ul> <li>Add/Modify/Delete Security Rules (Reads SecRulesinOCI sheet)</li> </ul> </li> <li>Route Rules<ul> <li>Add/Modify/Delete Route Rules (Reads RouteRulesinOCI sheet)</li> </ul> </li> <li>DRG Route Rules<ul> <li>Add/Modify/Delete DRG Route Rules (Reads DRGRouteRulesinOCI sheet)</li> </ul> </li> </ol> <p>Once the execution is successful, _seclists.auto.tfvars, _routetables.auto.tfvars and _drg-routetables.auto.tfvars file will be generated under the folder /cd3user/tenancies//terraform_files/. Existing files will move into respective backup folders. <p>NOTE: This will create TF for only those Security Lists and Route Tables in VCNs which are part of cd3 and skip any VCNs that have been created outside of cd3 execution.</p> <ol> <li>It will show different stages of execution of setUpOCI pipeline and also launch the terraform-apply pipeline for 'network'.</li> <li>Click on Proceed for 'Get Approval' stage of the terraform pipeline.</li> </ol> <p>This completes the modification of Security Rules, Route Rules and DRG Route Rules in OCI. Verify the components in console.</p> <p>Go back to Networking Scenarios</p>"},{"location":"NetworkingScenariosGF-Jenkins/#sync-manual-changes-done-in-oci-of-security-rules-route-rules-and-drg-route-rules-with-cd3-excel-sheet-and-terraform","title":"Sync manual changes done in OCI of Security Rules, Route Rules and DRG Route Rules with CD3 Excel Sheet and Terraform","text":"<p>Follow the below process to export the rules to the same CD3 Excel Sheet as the one used to Create Network, and to sync the Terraform files with OCI whenever an user adds, modifies or deletes rules in OCI Console manually.</p> <p>NOTE: Make sure to close your Excel sheet during the export process.</p> <ol> <li> <p>Execute the setupOCI.py pipeline with Workflow as Create Resources in OCI(Greenfield Workflow)</p> </li> <li> <p>Choose 'Network' from the displayed menu. Choose below sub-options:</p> </li> <li>Security Rules<ul> <li>Export Security Rules (From OCI into SecRulesinOCI sheet)</li> <li>Add/Modify/Delete Security Rules (Reads SecRulesinOCI sheet)</li> </ul> </li> <li>Route Rules<ul> <li>Export Route Rules (From OCI into RouteRulesinOCI sheet)</li> <li>Add/Modify/Delete Route Rules (Reads RouteRulesinOCI sheet)</li> </ul> </li> <li> <p>DRG Route Rules</p> <ul> <li>Export DRG Route Rules (From OCI into DRGRouteRulesinOCI sheet)</li> <li>Add/Modify/Delete DRG Route Rules (Reads DRGRouteRulesinOCI sheet)</li> </ul> <p>Once the execution is successful, 'RouteRulesInOCI', 'SecRulesInOCI', 'DRGRouteRulesInOCI' tabs of the excel sheet will be updated with the rules exported from OCI. And _seclists.auto.tfvars,  \\routetables.auto.tfvars and  \\drg-routetables.auto.tfvars file will be generated under the folder /cd3user/tenancies//terraform_files// <li> <p>It will show different stages of execution of setUpOCI pipeline and also launch the terraform-apply pipeline for 'network'.</p> </li> <li>Click on Proceed for 'Get Approval' stage of the terraform pipeline.</li> <p>This completes the export of Security Rules, Route Rules and DRG Route Rules from OCI. Terraform plan/apply should be in sync with OCI.</p> <p>Go back to Networking Scenarios</p>"},{"location":"NetworkingScenariosGF-Jenkins/#addmodifydelete-nsgs","title":"Add/Modify/Delete NSGs","text":"<p>Follow the below steps to update NSGs.</p> <ol> <li> <p>Modify your excel sheet to update required data in the Tabs - NSGs.</p> </li> <li> <p>Execute the setupOCI.py pipeline with Workflow as Create Resources in OCI(Greenfield Workflow)</p> </li> <li> <p>Choose 'Network' from the displayed menu. Choose below sub-option:</p> </li> <li> <p>Network Security Groups</p> <ul> <li>Add/Modify/Delete NSGs (Reads NSGs sheet)</li> </ul> <p>Once the execution is successful,  _nsgs.auto.tfvars will be generated under the folder /cd3user/tenancies//terraform_files//. Existing files will move into respective backup folders. <li> <p>It will show different stages of execution of setUpOCI pipeline and also launch the terraform-apply pipeline for 'nsg'.</p> </li> <li>Click on Proceed for 'Get Approval' stage of the terraform pipeline.</li> <p>This completes the modification of NSGs in OCI. Verify the components in console.</p> <p>Go back to Networking Scenarios</p>"},{"location":"NetworkingScenariosGF-Jenkins/#addmodifydelete-vlans","title":"Add/Modify/Delete VLANs","text":"<p>Follow the below steps to update VLANs.</p> <ol> <li>Modify your excel sheet to update required data in the Tabs - SubnetsVLANs.</li> <li> <p>Make sure that the RouteRulesinOCI sheet and corresponing terraform is in synch with route rules in OCI console. If not, please follow procedure specified in Sync manual changes done in OCI of Security Rules, Route Rules and DRG Route Rules with CD3 Excel Sheet and Terraform </p> </li> <li> <p>Execute the setupOCI.py pipeline with Workflow as Create Resources in OCI(Greenfield Workflow)</p> </li> <li>Choose 'Network' from the displayed menu. Choose below sub-option:</li> <li> <p>Add/Modify/Delete VLANs (Reads SubnetsVLANs sheet)</p> <p>Once the execution is successful,  _vlans.auto.tfvars will be generated under the folder /cd3user/tenancies//terraform_files//. Existing files will move into respective backup folders.  \\routetables.auto.tfvars file will also be updated with the route table information specified for each VLAN. <li> <p>It will show different stages of execution of setUpOCI pipeline and also launch the terraform-apply pipeline for 'vlan' and 'network'.</p> </li> <li> <p>Click on Proceed for 'Get Approval' stage of the terraform pipeline.</p> </li> <li> <p>Again make sure to export the Route Rules in OCI into excel and terraform. Please follow procedure specified in Sync manual changes done in OCI of Security Rules, Route Rules and DRG Route Rules with CD3 Excel Sheet and Terraform </p> </li> <p>This completes the modification of VLANs in OCI. Verify the components in console.</p>"},{"location":"NetworkingScenariosGF-Jenkins/#rpcs","title":"RPCs","text":"<p>Remote VCN peering is the process of connecting two VCNs in different regions (but the same tenancy). The peering allows the VCNs' resources to communicate using private IP addresses without routing the traffic over the internet or through your on-premises network.</p> <ul> <li>Modify your excel sheet to update required data in the Tabs - DRGs.</li> <li>The source and target RPC details to be entered in DRG sheet for establishing a connection. Please check the example in excel file for reference.</li> <li>Make sure that the DRGRouteRulesinOCI sheet and corresponding to terraform is in synch with DRG route rules in OCI console. If not, please follow procedure specified in Sync manual changes done in OCI of Security Rules, Route Rules and DRG Route Rules with CD3 Excel Sheet and Terraform</li> <li>Global directory which is inside the customer outdir will have all RPC related files and scripts.</li> <li>The RPC resources(modules,provider configurations etc) are generated dynamically for the tenancy and can work along only with CD3 automation toolkit.</li> <li>Choose option 'Network' and then 'Customer Connectivity' for creating RPC in GreenField workflow.</li> <li>Output files are created under /cd3user/tenancies//terraform_files/global/rpc directory <p>Go back to Networking Scenarios </p>   | :arrow_backward: Prev | Next :arrow_forward: | | :---- | -------: |"},{"location":"NetworkingScenariosGF/","title":"Networking Scenarios","text":""},{"location":"NetworkingScenariosGF/#managing-network-for-greenfield-workflow","title":"Managing Network for Greenfield Workflow","text":"<ul> <li>Create Network</li> <li>Use an existing DRG in OCI while creating the network</li> <li>Modify Network</li> <li>Modify Security Rules, Route Rules and DRG Route Rules</li> <li>Sync manual changes done in OCI of Security Rules, Route Rules and DRG Route Rules with CD3 Excel Sheet and Terraform</li> <li>Add/Modify/Delete NSGs</li> <li>Add/Modify/Delete VLANs</li> <li>Remote Peering Connections</li> </ul> <p>NOTE- Before you start with Network Creation, make sure you have run 'Fetch Compartments OCIDs to variables file'.</p>"},{"location":"NetworkingScenariosGF/#create-network","title":"Create Network","text":"<p>Creation of Networking components using Automation Toolkit involves four simple steps.  - Add the networking resource details to appropriate Excel Sheets.  - Running the toolkit to generate auto.tfvars.  - Executing Terraform commands to provision the resources in OCI.  - Exporting the automatically generated Security Rules and Route Rules by the toolkit to CD3 Excel Sheet.</p> <p>Below are the steps in detail to create Network that includes VCNs, Subnets, DHCP, DRG, Security List, Route Tables, DRG Route Tables, NSGs, etc.</p> <ol> <li> <p>Choose appropriate excel sheet from Excel Templates and fill the required Network details in the Networking Tabs - VCNs, DRGs, VCN Info, DHCP, Subnets, NSGs tabs.</p> </li> <li> <p>Execute the setupOCI.py file with workflow_type parameter value to create_resources:</p> </li> </ol> <p><code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code></p> <ol> <li> <p>Choose option 'Validate CD3' and then 'Validate Network(VCNs, Subnets, DHCP, DRGs)' to check for syntax errors in Excel sheet. Examine the log file generated at /cd3user/tenancies//_cd3validator.log. If there are errors, please rectify them accordingly and proceed to the next step. <li> <p>Choose option to 'Create Network' under 'Network' from the displayed menu. Once the execution is successful, multiple .tfvars related to networking like _major-objects.auto.tfvars and more will be generated under the folder /cd3user/tenancies//terraform_files// <li> <p>Navigate to the above path and execute the terraform commands: terraform init terraform plan terraform apply</p> </li> <p>This completes the creation of Networking components in OCI. Verify the components in console. However the details of the default security lists and default route tables may not be available in the CD3 Excel sheet yet. Inorder to export that data please follow the below steps:</p> <ol> <li>Execute the setupOCI.py file with workflow_type parameter value to create_resources:</li> </ol> <p><code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code></p> <ol> <li>Choose 'Network' from the displayed menu. Choose below sub-options: (Make sure to choose all the three optionsfor the first time)</li> <li>Security Rules<ul> <li>Export Security Rules (From OCI into SecRulesinOCI sheet)</li> </ul> </li> <li>Route Rules<ul> <li>Export Route Rules (From OCI into RouteRulesinOCI sheet)</li> </ul> </li> <li>DRG Route Rules<ul> <li>Export DRG Route Rules (From OCI into DRGRouteRulesinOCI sheet)</li> </ul> </li> </ol> <p>This completes the steps for Creating the Network in OCI and exporting the default rules to the CD3 Excel Sheet using the Automation Toolkit.</p>"},{"location":"NetworkingScenariosGF/#use-an-existing-drg-in-oci-while-creating-the-network","title":"Use an existing DRG in OCI while creating the network","text":"<p>In some scenarios, a DRG has already been created in the tenancy and rest of the Network components still need to be created. In such cases, generate the networking related tfvars using same process mentioned above till Step 4. Use same name for DRG in DRGs tab as present in OCI console.</p> <ul> <li>For Step 5, Navigate to the outdir path and execute the terraform commands: terraform init terraform import \"module.drgs[\\\"&lt;&lt;drgs terraform variable name&gt;&gt;\\\"].oci_core_drg.drg\" &lt;&lt;drg-ocid&gt;&gt; \u00a0\u00a0\u2192 This will Import the DRG into your state file.      terraform plan \u00a0\u00a0\u2192 Terraform Plan will indicate to add all the other components except DRG.        terraform apply</li> </ul> <p>Continue executing the remaining steps (from Step 6) of Create Network.</p> <p>Go back to Networking Scenarios</p>"},{"location":"NetworkingScenariosGF/#modify-network","title":"Modify Network","text":"<p>Modifying the Networking components using Automation Toolkit involves three simple steps.  - Add/modify the details of networking components like the VCNs, Subnets, DHCP and DRG in Excel Sheet.  - Running the toolkit to generate auto.tfvars.  - Executing Terraform commands to provision/modify the resources in OCI.</p> <p>Note: Follow these steps to modify Security Rules, Route Rules and DRG Route Rules</p> <p>Steps in detail: 1. Modify your excel sheet to update required data in the Tabs - VCNs, DRGs, VCN Info, DHCP and Subnets.</p> <ol> <li>Execute the setupOCI.py file with workflow_type parameter value to create_resources:</li> </ol> <p><code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code></p> <ol> <li> <p>To Validate the CD3 excel Tabs - Choose option 'Validate CD3' and 'Validate Network(VCNs, Subnets, DHCP, DRGs)' from sub-menu to check for syntax errors in Excel sheet. Examine the log file generated at /cd3user/tenancies//_cd3validator.logs. If there are errors, please rectify them accordingly and proceed to the next step. <li> <p>Choose option to 'Modify Network' under 'Network' from the displayed menu. Once the execution is successful, multiple .tfvars related to networking like _major-objects.auto.tfvars and more will be generated under the folder /cd3user/tenancies//terraform_files//. Existing files will move into respective backup folders. <p>Note-: Make sure to export Sec Rules, Route Rules, DRG Route Rules to CD3 Excel Sheet before executing this option.</p> <ol> <li>Navigate to the above path and execute the terraform commands: terraform init terraform plan terraform apply</li> </ol> <p>This completes the modification of Networking components in OCI. Verify the components in console.</p> <p>Go back to Networking Scenarios</p>"},{"location":"NetworkingScenariosGF/#modify-security-rules-route-rules-and-drg-route-rules","title":"Modify Security Rules, Route Rules and DRG Route Rules","text":"<p>Follow the below steps to add, update or delete the following components: - Security Lists and Security Rules - Route Table and Route Rules - DRG Route Table and DRG Route Rules</p> <ol> <li> <p>Modify your excel sheet to update required data in the Tabs - RouteRulesInOCI, SecRulesInOCI, DRGRouteRulesInOCI tabs.</p> </li> <li> <p>Execute the setupOCI.py file with workflow_type parameter value to create_resources:</p> </li> </ol> <p><code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code></p> <ol> <li>Choose 'Network' from the displayed menu. Choose below sub-options:</li> <li>Security Rules<ul> <li>Add/Modify/Delete Security Rules (Reads SecRulesinOCI sheet)</li> </ul> </li> <li>Route Rules<ul> <li>Add/Modify/Delete Route Rules (Reads RouteRulesinOCI sheet)</li> </ul> </li> <li>DRG Route Rules<ul> <li>Add/Modify/Delete DRG Route Rules (Reads DRGRouteRulesinOCI sheet)</li> </ul> </li> </ol> <p>Once the execution is successful, _seclists.auto.tfvars, _routetables.auto.tfvars and _drg-routetables.auto.tfvars file will be generated under the folder /cd3user/tenancies//terraform_files/. Existing files will move into respective backup folders. <p>NOTE: This will create TF for only those Security Lists and Route Tables in VCNs which are part of cd3 and skip any VCNs that have been created outside of cd3 execution.</p> <pre><code>  Navigate to the above path and execute the terraform commands:&lt;br&gt;\n   &lt;br&gt;_terraform init_\n   &lt;br&gt;_terraform plan_\n   &lt;br&gt;_terraform apply_\n</code></pre> <p>This completes the modification of Security Rules, Route Rules and DRG Route Rules in OCI. Verify the components in console.</p> <p>Go back to Networking Scenarios</p>"},{"location":"NetworkingScenariosGF/#sync-manual-changes-done-in-oci-of-security-rules-route-rules-and-drg-route-rules-with-cd3-excel-sheet-and-terraform","title":"Sync manual changes done in OCI of Security Rules, Route Rules and DRG Route Rules with CD3 Excel Sheet and Terraform","text":"<p>Follow the below process to export the rules to the same CD3 Excel Sheet as the one used to Create Network, and to sync the Terraform files with OCI whenever an user adds, modifies or deletes rules in OCI Console manually.</p> <p>NOTE: Make sure to close your Excel sheet during the export process.</p> <ol> <li>Execute the setupOCI.py file with workflow_type parameter value to create_resources:</li> </ol> <p><code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code></p> <ol> <li>Choose 'Network' from the displayed menu. Choose below sub-options:</li> <li>Security Rules<ul> <li>Export Security Rules (From OCI into SecRulesinOCI sheet)</li> </ul> </li> <li>Route Rules<ul> <li>Export Route Rules (From OCI into RouteRulesinOCI sheet)</li> </ul> </li> <li> <p>DRG Route Rules</p> <ul> <li>Export DRG Route Rules (From OCI into DRGRouteRulesinOCI sheet)</li> </ul> <p>Once the execution is successful, 'RouteRulesInOCI', 'SecRulesInOCI', 'DRGRouteRulesInOCI' tabs of the excel sheet will be updated with the rules exported from OCI. At this point, we only have our Excel sheet Tabs updated, proceed to the next step to create the Terraform Files for the same.</p> </li> <li> <p>Choose 'Network' from the displayed menu. Choose below sub-options:</p> </li> <li>Security Rules<ul> <li>Add/Modify/Delete Security Rules (Reads SecRulesinOCI sheet)</li> </ul> </li> <li>Route Rules<ul> <li>Add/Modify/Delete Route Rules (Reads RouteRulesinOCI sheet)</li> </ul> </li> <li>DRG Route Rules<ul> <li>Add/Modify/Delete DRG Route Rules (Reads DRGRouteRulesinOCI sheet)</li> </ul> </li> </ol> <p>Once the execution is successful, _seclists.auto.tfvars,  \\routetables.auto.tfvars and  \\drg-routetables.auto.tfvars file will be generated under the folder /cd3user/tenancies//terraform_files// <p>Navigate to the above path and execute the terraform commands: terraform init terraform plan terraform apply</p> <p>This completes the export of Security Rules, Route Rules and DRG Route Rules from OCI. Terraform plan/apply should be in sync with OCI.</p> <p>Go back to Networking Scenarios</p>"},{"location":"NetworkingScenariosGF/#addmodifydelete-nsgs","title":"Add/Modify/Delete NSGs","text":"<p>Follow the below steps to update NSGs.</p> <ol> <li> <p>Modify your excel sheet to update required data in the Tabs - NSGs.</p> </li> <li> <p>Execute the setupOCI.py file with workflow_type parameter value to create_resources:</p> </li> </ol> <p><code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code></p> <ol> <li>Choose 'Network' from the displayed menu. Choose below sub-option:</li> <li> <p>Network Security Groups</p> <ul> <li>Add/Modify/Delete NSGs (Reads NSGs sheet)</li> </ul> <p>Once the execution is successful,  _nsgs.auto.tfvars will be generated under the folder /cd3user/tenancies//terraform_files//. Existing files will move into respective backup folders. <li> <p>Navigate to the above path and execute the terraform commands: terraform init terraform plan terraform apply</p> </li> <p>This completes the modification of NSGs in OCI. Verify the components in console.</p> <p>Go back to Networking Scenarios</p>"},{"location":"NetworkingScenariosGF/#addmodifydelete-vlans","title":"Add/Modify/Delete VLANs","text":"<p>Follow the below steps to update VLANs.</p> <ol> <li>Modify your excel sheet to update required data in the Tabs - SubnetsVLANs.</li> <li> <p>Make sure that the RouteRulesinOCI sheet and corresponing terraform is in synch with route rules in OCI console. If not, please follow procedure specified in Sync manual changes done in OCI of Security Rules, Route Rules and DRG Route Rules with CD3 Excel Sheet and Terraform </p> </li> <li> <p>Execute the setupOCI.py file with workflow_type parameter value to create_resources:</p> </li> </ol> <p><code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code></p> <ol> <li>Choose 'Network' from the displayed menu. Choose below sub-option:</li> <li> <p>Add/Modify/Delete VLANs (Reads SubnetsVLANs sheet)</p> <p>Once the execution is successful,  _vlans.auto.tfvars will be generated under the folder /cd3user/tenancies//terraform_files//. Existing files will move into respective backup folders.  \\routetables.auto.tfvars file will also be updated with the route table information specified for each VLAN. <li> <p>Navigate to the above path and execute the terraform commands: terraform init terraform plan terraform apply</p> </li> <li> <p>Again make sure to export the Route Rules in OCI into excel and terraform. Please follow procedure specified in Sync manual changes done in OCI of Security Rules, Route Rules and DRG Route Rules with CD3 Excel Sheet and Terraform </p> </li> <p>This completes the modification of VLANs in OCI. Verify the components in console.</p>"},{"location":"NetworkingScenariosGF/#rpcs","title":"RPCs","text":"<p>Remote VCN peering is the process of connecting two VCNs in different regions (but the same tenancy). The peering allows the VCNs' resources to communicate using private IP addresses without routing the traffic over the internet or through your on-premises network.</p> <ul> <li>Modify your excel sheet to update required data in the Tabs - DRGs.</li> <li>The source and target RPC details to be entered in DRG sheet for establishing a connection. Please check the example in excel file for reference.</li> <li>Make sure that the DRGRouteRulesinOCI sheet and corresponding to terraform is in synch with DRG route rules in OCI console. If not, please follow procedure specified in Sync manual changes done in OCI of Security Rules, Route Rules and DRG Route Rules with CD3 Excel Sheet and Terraform</li> <li>Global directory which is inside the customer outdir will have all RPC related files and scripts.</li> <li>The RPC resources(modules,provider configurations etc) are generated dynamically for the tenancy and can work along only with CD3 automation toolkit.</li> <li>Choose option 'Network' and then 'Customer Connectivity' for creating RPC in GreenField workflow.</li> <li>Output files are created under /cd3user/tenancies//terraform_files/global/rpc directory <p>Go back to Networking Scenarios </p>   | :arrow_backward: Prev | Next :arrow_forward: | | :---- | -------: |"},{"location":"NetworkingScenariosNGF/","title":"Networking Scenarios","text":""},{"location":"NetworkingScenariosNGF/#managing-network-for-non-greenfield-workflow","title":"Managing Network for Non-Greenfield Workflow","text":"<ul> <li>Export Network</li> <li>Add a new or modify the existing networking components</li> </ul> <p>NOTE- Before you start with Network Export, make sure you have run 'Fetch Compartments OCIDs to variables file'.</p>"},{"location":"NetworkingScenariosNGF/#export-network","title":"Export Network","text":"<p>Follow the below steps to export the Networking components that includes VCNs, Subnets, DHCP, DRG, Security List, Route Tables, DRG Route Tables, NSGs, etc to CD3 Excel Sheet and create the Terraform state.</p> <ol> <li> <p>Use the CD3-Blank-Template.xlsx to export the networking resources into the Tabs - VCNs, DRGs, VCN Info, DHCP, Subnets, NSGs, RouteRulesInOCI, SecRulesInOCI,DRGRouteRulesInOCI tabs.</p> </li> <li> <p>Execute the setupOCI.py file with workflow_type parameter value to export_resources:</p> </li> </ol> <p><code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code></p> <ol> <li>Choose one of the below available sub-options from 'Export Network' of the main menu. </li> <li>Export all Network Components</li> <li>Export Network components for VCNs, DRGs and DRGRouteRulesinOCI Tabs</li> <li>Export Network components for DHCP Tab</li> <li>Export Network components for SecRulesinOCI Tab</li> <li>Export Network components for RouteRulesinOCI Tab</li> <li>Export Network components for SubnetsVLANs Tab</li> <li>Export Network components for NSGs Tab</li> </ol> <p>Once the execution is successful, networking related .tfvars files and .sh files containing import statements will be generated under the folder /cd3user/tenancies//terraform_files// <p>Also,The RPC related .tfvars and .sh files containing import statements will be generated in global directory which is inside the /cd3user/tenancies//terraform_files/ folder.  <p>NOTE: The oci_core_drg_attachment_management for RPC resources will be shown as created at the end of import process, but it doesn't actually create any resources and can be safely ignored.</p> <p></p> <p>Navigate to the above path and execute the terraform commands: terraform init Execute the shell scirpts of networking components terraform plan \u00a0\u00a0\u2192 Terraform Plan must show that all the components are in sync.</p> <p>This completes the export of Networking components from OCI.</p> <p>Sample of CD3 Excel after export: (DO NOT Modify the highlighted columns)</p> <p>(Showing old images below) VCNs tab: </p> <p>Subnets tab: </p> <p>Go back to Networking Scenarios</p>"},{"location":"NetworkingScenariosNGF/#add-a-new-or-modify-the-existing-networking-components","title":"Add a new or modify the existing networking components","text":"<ol> <li>Export the Networking components by following the steps above. (Note that here workflow_type flag is set to export_resources)</li> <li>Follow the process to add new components such as VCN/DHCP/DRG/IGW/NGW/SGW/LPG/Subnet etc. (Note that here workflow_type flag is set to create_resources)</li> </ol> <p>Go back to Networking Scenarios</p> <p></p>   | :arrow_backward: Prev | Next :arrow_forward: | | :---- | -------: |"},{"location":"NonGreenField-Jenkins/","title":"Export Resources from OCI via Jenkins(Non-Greenfield Workflow)","text":"<p>Note: Please make sure that service for which export is done does not have existing tfvars/state file.</p> <p>Step 1:  Choose the appropriate CD3 Excel sheet template from Excel Templates Choose CD3-Blank-template.xlsx for an empty sheet.</p> <p>Step 2: Login to Jenkins URL with user created after initialization and click on setUpOCI pipeline from Dashboard. Click on Build with Parameters from left side menu.</p> <p></p> <p>Note - Only one user at a time using the Jenkins setup is supported in the current release of the toolkit.</p> <p>Step 3: Upload the above chosen Excel sheet in Excel_Template section.</p> <p></p> <p>This will copy the Excel file at <code>/cd3user/tenancies/&lt;customer_name&gt;</code> inside the container. It will also take backup of existing Excel on the container by appending the current datetime if same filename is uploaded in multiple executions.</p> <p>Step 4: Select the workflow as Export Resources from OCI(Non-Greenfield Workflow). Choose single or multiple MainOptions as required and then corresponding SubOptions. Below screenshot shows export of Network and Compute.</p> <p></p> <p>Step 5: Specify region and compartment from where you want to export the data. It also asks for service specific filters like display name patterns for compute. Leave empty if no filter is needed.</p> <p> Click on Build at the bottom.</p> <p>Step 6: setUpOCI pipeline is triggered and stages are executed as shown below: </p> <p> </p> <p>Expected Output of 'Execute setUpOCI' stage:</p> <ol> <li> Overwrites the specific tabs of Excel sheet with the exported resource details from OCI.</li> <li> Generates Terraform Configuration files - *.auto.tfvars.</li> <li> Generates shell scripts with import commands - tf_import_commands_&lt;resource&gt;_nonGF.sh </li> </ol> <p>Expected Output of 'Run Import Commands' stage:</p> <ol> <li>Executes shell scripts with import commands(tf_import_commands_&lt;resource&gt;_nonGF.sh) generated in the previous stage </li> </ol> <p>Expected Output of Terraform Pipelines:</p> <ol> <li>Respective pipelines will get triggered automatically from setUpOCI pipeline based on the services chosen for export. You could also trigger manually when required.</li> <li> If 'Run Import Commands' stage was successful (ie tf_import_commands_&lt;resource&gt;_nonGF.sh ran successfully for all services chosen for export), respective terraform pipelines triggered should have 'Terraform Plan' stage show as 'No Changes'  </li> </ol> <p></p> <p>Note:   Once you have exported the required resources and imported into tfstate, you can use the toolkit to modify them or create new on top of them using 'Create Resources in OCI' workflow.</p> <p></p>   | :arrow_backward: Prev | :arrow_forward: Next | | :---- | -------: |"},{"location":"NonGreenField/","title":"Export Resources from OCI (Non-Greenfield Workflow)","text":"<p>Note   Please make sure that service for which export is done does not have existing tfvars/state file. Course of actions involved in Exporting objects from OCI-    * Automation Tool Kit fetches the data for the supported services. You can chose to export the data from a specific region or the compartment. Exported data is written to appropriate sheets of the CD3 Excel Sheet based on the resources being exported. * Tool Kit then generates the TF configuration files/auto.tfvars files for these exported resources. * It also generates a shell script - tf_import_commands_<code>&lt;resource&gt;</code>_nonGF.sh that has the import commands, to import the state of the resources to tfstate file.(This helps to manage the resources via Terraform in future). </p> <p>Step 1: Chose the appropriate CD3 Excel sheet template from Excel Templates</p> <p>Step 2: Put CD3 Excel at the appropriate location. Modify/Review /cd3user/tenancies//_setUpOCI.properties with workflow_type set to export_resources  as shown below: <pre><code>#Input variables required to run setUpOCI script\n\n#path to output directory where terraform file will be generated. eg /cd3user/tenancies/&lt;customer_name&gt;/terraform_files\noutdir=/cd3user/tenancies/demotenancy/terraform_files/\n\n#prefix for output terraform files eg &lt;customer_name&gt; like demotenancy\nprefix=demotenancy\n\n# auth mechanism for OCI APIs - api_key,instance_principal,session_token\nauth_mechanism=api_key\n\n#input config file for Python API communication with OCI eg /cd3user/tenancies/&lt;customer_name&gt;/.config_files/&lt;customer_name&gt;_config;\nconfig_file=/cd3user/tenancies/demotenancy/.config_files/demotenancy_oci_config\n\n# Leave it blank if you want single outdir or specify outdir_structure_file.properties containing directory structure for OCI services.\noutdir_structure_file=/cd3user/tenancies/demotenancy/demotenancy_outdir_structure_file.properties\n\n#path to cd3 excel eg /cd3user/tenancies/&lt;customer_name&gt;/CD3-Customer.xlsx\ncd3file=/cd3user/tenancies/demotenancy/CD3-Blank-template.xlsx\n\n#specify create_resources to create new resources in OCI(greenfield workflow)\n#specify export_resources to export resources from OCI(non-greenfield workflow)\nworkflow_type=export_resources\n</code></pre> <p>Step 3: Execute the SetUpOCI.py script to start exporting the resources to CD3 and creating the terraform configuration files.</p> <p>Command to Execute: <code>cd /cd3user/oci_tools/cd3_automation_toolkit/</code> python setUpOCI.py  ie <code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code> <p>\u2192 Example execution of the wrapper script:</p> <p></p> <p>Choose the resources by specifying a single option (for choosing one of these resources) or comma-separated values (to choose multiple resources) as shown in the sample screenshot above.</p> <p>Make sure to execute \"Fetch Compartments OCIDs to variables file\" from CD3 Services in setUpOCI menu at least once. This will       ensure that the variables file in outdir is updated with the OCID information of all the compartments.</p> <p>Toolkit will over-write the specific tabs of CD3 Excel sheet with exported data for that resource in OCI while the other tabs remain intact.</p> <p></p> <p>Expected Outputs: a. Excel sheet with the resource details from OCI b. Terraform Configuration files - *.auto.tfvars c. Shell Script with import commands - tf_import_commands_<code>&lt;resource&gt;</code>_nonGF.sh </p> <p>Action: Execute the tf_import_commands_<code>&lt;resource&gt;</code>_nonGF.sh files that are generated in the outdir. The terraform plan should show that infrastructure is up-to-date with no changes required for all regions.</p> <p></p> <p>Note   Once the export (including the execution of tf_import_commands_<code>&lt;resource&gt;</code>_nonGF.sh) is complete, switch the value of workflow_type back to create_resources.    This allows the Tool Kit to support the tenancy as Green Field from this point onwards.</p>"},{"location":"NonGreenField/#example-export-identity","title":"Example - Export Identity","text":"<p>Follow the below steps to quickly export Identity components from OCI.</p> <ol> <li> <p>Use the excel CD3-Blank-template and place it at the location /cd3user/tenancies// which is also mapped to your local directory. <li> <p>Edit the setUpOCI.properties at location:/cd3user/tenancies //_setUpOCI.properties with appropriate values.  <li>Update the cd3file parameter to specify the CD3 excel sheet path.</li> <li> <p>Set the workflow_type parameter value to export_resources. (for Non Greenfield Workflow.)</p> </li> <li> <p>Change Directory to 'cd3_automation_toolkit' :     <code>cd /cd3user/oci_tools/cd3_automation_toolkit/</code></p> </li> <p>and execute the setupOCI.py file:</p> <p><code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code>  4. Choose option 'Export Identity' from the displayed menu. Once the execution is successful, you will see:       <ul> <li>Filled in tabs-Compartments, Groups, Polecies of Excel sheet</li> <li>tf_import_commands_identity_nonGF.sh</li> <li>&lt;customer_name&gt;_compartments.auto.tfvars, &lt;customer_name&gt;_groups.auto.tfvars, &lt;customer_name&gt;_policies.auto.tfvars</li> </ul></p> <ol> <li>Execute tf_import_commands_identity_nonGF.sh to start importing the identity components into tfstate file.</li> <li>Repeat the above process (except Step 5) to export other components from OCI. </li> </ol>   | :arrow_backward: Prev | Next :arrow_forward: | | :---- | -------: |"},{"location":"OPAForCompliance/","title":"Enforcing OPA (Open Policy Agent) policies for Terraform","text":""},{"location":"OPAForCompliance/#open-policy-agent-for-terraform","title":"Open Policy Agent for Terraform:","text":"<p>OPA is a powerful policy-as-code framework that enables you to define and enforce policies across your infrastructure-as-code (IaC) deployments. With OPA, you can seamlessly integrate policy checks into your Terraform workflows, ensuring that your infrastructure deployments adhere to your organization's security, compliance, and operational requirements.</p> <p>By leveraging OPA for Terraform, you can automate policy enforcement, eliminate manual checks, and enforce best practices consistently across your infrastructure-as-code projects. With OPA, you gain enhanced visibility and control over your Terraform deployments, reducing the risk of misconfigurations, security vulnerabilities, and compliance issues. </p> <p>As part of CD3, we have meticulously developed a comprehensive set of policies that strictly adhere to the CIS benchmarks. These policies serve as your shield, ensuring that any Infrastructure-as-Code (IAC) deployments made for Oracle Cloud Infrastructure (OCI) meet the highest security and compliance standards.</p> <p>Our carefully crafted policies act as gatekeepers, preventing any IAC deployments that do not align with the stringent security and compliance guidelines set by the CIS benchmarks for OCI. By leveraging our policies, you can ensure that your infrastructure deployments remain impervious to any potential vulnerabilities or non-compliance issues.</p>"},{"location":"OPAForCompliance/#run-opa-inside-cd3-container","title":"Run OPA inside CD3 container","text":"<ol> <li> <p>Open your command line interface inside CD3 container and run OPA. You should see all available options for OPA.</p> <pre><code>opa --help\n</code></pre> <p>Currently CD3 container has OPA version 0.55.0 installed.</p> </li> <li> <p>Generate the terraform plan output in json format since OPA accepts that format alone for evaluation.</p> <pre><code> terraform plan -out tfplan.binary\n terraform show -json tfplan.binary &gt; tfplan.json\n</code></pre> </li> <li> <p>Run the terraform plan against all the available OPA rules. It should return an empty array which means the plan has no non-compliant action against CIS benchmarks.</p> <pre><code>opa eval -f pretty -b /cd3user/oci_tools/cd3_automation_toolkit/user-scripts/OPA -i tfplan.json data.terraform.deny --fail-defined\n</code></pre> </li> </ol> <p>Alternatively, run the following command to evaluate just a sinle OPA rule say \"deny_ingress_for_sl.rego\" policy with a pretty output format:</p> <pre><code>    opa eval -f pretty -d /cd3user/oci_tools/cd3_automation_toolkit/user-scripts/OPA/Networking/oci_deny_ingress_for_sl.rego -i tfplan.json data.terraform.deny\n</code></pre> <p>This command will analyze the \"tfplan.json\" input file against the policy and display the evaluation results with a user-friendly format.</p> <p></p>   | :arrow_backward: Prev | Next :arrow_forward: | | :---- | -------: |"},{"location":"ReleaseInfo/","title":"ReleaseInfo","text":""},{"location":"ReleaseInfo/#release-info","title":"Release-Info","text":""},{"location":"ReleaseInfo/#automation-toolkit-release-v10-docker-image-release-v60","title":"Automation Toolkit Release v10 &amp; Docker Image Release v6.0","text":""},{"location":"ReleaseInfo/#date-jan-13th-2023","title":"Date - Jan 13<sup>th</sup>, 2023","text":"<p>This is a major release with below updates:</p> <ol> <li>Support for new services - OKE and SCH. New tab for 'OKE' is included in CD3-CIS-template.xlsx. New tab for 'ServiceConnectors' is added to CD3-CIS-ManagementServices-template.xlsx.</li> <li>Added the script to fetch regions subscribed to the tenancy. This will be executed automatically every time setUpOCI is executed.</li> <li>Introduced a new option in setUpOCI menu called 'CD3 Services' to execute 'Fetch Compartments' and 'Fetch Protocols Scripts.</li> <li>Modified the setUpOCI workflow to prompt the user to execute 'Fetch Compartments' script in case it has not been executed previously.</li> <li>Bug fixes wrt Instances, DB Systems</li> </ol>"},{"location":"ReleaseInfo/#automation-toolkit-release-v921-docker-image-release-v521","title":"Automation Toolkit Release v9.2.1 &amp; Docker Image Release v5.2.1","text":""},{"location":"ReleaseInfo/#date-nov-30th-2022","title":"Date - Nov 30<sup>th</sup>, 2022","text":"<p>This is a minor release with below updates:</p> <ol> <li>Sample terraform import command included as part of output tfvars file for each OCI resource managed by Toolkit.</li> <li>Split Export of Network options to chose export of different components separately eg Major Objects, Subnets, NSGs etc.</li> <li>Include support for Marketplace Images for Instances.</li> <li>Few bug fixes/enhancements wrt export of Instances/NSGs, making null values for NSGs/Instances optional in tfvars</li> </ol>"},{"location":"ReleaseInfo/#previous-versions-released-before-making-it-available-on-github","title":"Previous Versions released before making it available on GitHub","text":""},{"location":"ReleaseInfo/#automation-toolkit-release-v92-docker-image-release-v52","title":"Automation Toolkit Release v9.2 &amp; Docker Image Release v5.2","text":""},{"location":"ReleaseInfo/#date-oct-10th-2022","title":"Date - Oct 10<sup>th</sup>, 2022","text":"<p>This is a major release with existing services converted into terraform modules and also bug fixes.</p> <ol> <li>Terraform modules for FSS and ADB(Modified the input sheet for ADB to include more features)</li> <li>Included new service - Network Load Balancers</li> <li>Enhanced Tags sheet to include Default Tags for Multiple Compartments.</li> <li>Enhanced CD3 Validator for FSS, NSGs column for each tab.</li> <li>Included CIS compliance checker script as part of setUpOCI Menu option</li> <li>Cleanup of variables_.tf file <li>Updated CD3 templates in example folder with latest CIS data</li> <li>Bug fixes wrt multiple services like Instances, Notifications etc</li> <li>Introduced documentation folder containing terraform and toolkit user guide in outdir of each customer</li>"},{"location":"ReleaseInfo/#automation-toolkit-release-v91-docker-image-release-v51","title":"Automation Toolkit Release v9.1 &amp; Docker Image Release v5.1","text":""},{"location":"ReleaseInfo/#date-jun-13th-2022","title":"Date - Jun 13<sup>th</sup>, 2022","text":"<p>This is a major release with existing services converted into terraform modules and also bug fixes.</p> <ol> <li>Terraform Modules for Instances, Block Volumes, Tags, CIS features, LBaas.</li> <li>Introduced new columns for PV encryption in Instances/Block Volumes.</li> <li>Introduced new columns for Min/Max bandwidth for flexible shapes load balancers, reserved public IP. Support for OCI certificate management certificates for Listeners, BackendSets.</li> <li>Removed support for subnet_name_attach_cidr parameter from CD3 excel's 'VCN Info' sheet.</li> <li>Bug fixes</li> </ol>"},{"location":"ReleaseInfo/#automation-toolkit-release-v902-docker-image-release-v502","title":"Automation Toolkit Release v9.0.2 &amp; Docker Image Release v5.0.2","text":""},{"location":"ReleaseInfo/#date-april-29-2022","title":"Date - April 29, 2022","text":"<p>This is a minor release with bug fixes related to Networking and Identity Policies.</p>"},{"location":"ReleaseInfo/#automation-toolkit-release-v901-docker-image-release-v501","title":"Automation Toolkit Release v9.0.1 &amp; Docker Image Release v5.0.1","text":""},{"location":"ReleaseInfo/#date-april-9-2022","title":"Date - April 9, 2022","text":"<p>This is a minor release.</p> <ol> <li>Bug fix for data after END tag in DRGRouteRulesinOCI sheet.</li> <li>Bug fix for tenancies having both DRGv1 and DRGv2</li> <li>Bug fix for VCN Flow Log output</li> <li>Bug fix for NSG ICMP rules not having only ICMP type</li> <li>Modified output template files to adjust the spacing</li> </ol>"},{"location":"ReleaseInfo/#automation-toolkit-release-v90-docker-image-release-v50","title":"Automation Toolkit Release v9.0 &amp; Docker Image Release v5.0","text":""},{"location":"ReleaseInfo/#date-march-21-2022","title":"Date - March 21, 2022","text":"<p>This is a major release.</p> <ol> <li>Terraform output files in modules format for IAM, Network, Database(DBSystems and Exa) and Management Services(Events, Notifications) components.</li> <li>Added support for Alarms with output files as terraform modules.</li> <li>Updated the excel sheet templates as per latest CIS compliance for IAM compartments, groups, policies, events, notifications and alarms.</li> <li>Added support for multiple VCN CIDRs in VCNs sheet.</li> <li>Added support for same VCN names across regions.</li> <li>Added export for Dedicated VM Hosts and Database tabs as terraform flat files</li> <li>Modified Database tabs to include new features.</li> <li>Restructured the code directories and setUpOCI menu options.</li> <li>Added drop downs in the excel sheet columns to make excel filling easier.</li> <li>Updated OCI_regions to include all regions</li> <li>Deprecation of OCSWorkVM.</li> </ol>"},{"location":"ReleaseInfo/#automation-toolkit-release-v803-docker-image-release-v403","title":"Automation Toolkit Release v8.0.3 &amp; Docker Image Release v4.0.3","text":""},{"location":"ReleaseInfo/#date-nov-26-2021","title":"Date - Nov 26 , 2021","text":"<p>This is a minor release.</p> <ol> <li>Bug fix for Availability Domain values while export of block volumes, FSS</li> <li>Bug fix for DRG Route Rules export error - 'Too Many requests'</li> <li>Bug fix for export of Tags having spaces in the values</li> </ol>"},{"location":"ReleaseInfo/#automation-toolkit-release-v802-docker-image-release-v402","title":"Automation Toolkit Release v8.0.2 &amp; Docker Image Release v4.0.2","text":""},{"location":"ReleaseInfo/#date-sep-30-2021","title":"Date - Sep 30 , 2021","text":"<p>This is a minor release.</p> <ol> <li>Bug fix for End Tag in NSGs tab</li> <li>Bug fix for export of LBR hosted in two subnets in different compartments.</li> <li>Bug fix for terraform variable name for route table names</li> <li>Allow case insensitive for Security Rule Types/Protocols</li> <li>Allow flexible shapes in LBR CD3</li> </ol>"},{"location":"ReleaseInfo/#automation-toolkit-release-v80-docker-image-release-v40","title":"Automation Toolkit Release v8.0 &amp; Docker Image Release v4.0","text":""},{"location":"ReleaseInfo/#date-jul-27-2021","title":"Date - Jul 27 , 2021","text":"<p>This is a major release.</p> <ol> <li>Support for DRGv2 - added 2 new sheets to CD3: DRGs and DRGRouteRulesinOCI</li> <li>Backward compatible to support DRGv1</li> <li>Updated CD3 Validator to include validation for DRGs tab</li> <li>Optimized the code for export of objects</li> <li>Bug fix for export of SecRules and RouteRules for all compartments</li> <li>Updated the toolkit to support user access to a single compartment by allowing creation of sub-compartments under that only.</li> <li>Included export of additional objects for Instances and Block Volumes</li> <li>CD3 templates are compliant to latest CIS Landing Zone</li> <li>Upgrade terraform version to 1.0.0</li> <li>Please note that since this release is upgrading the terraform version so previous version's terraform state will not be compatible with the new tf files. Recommendation is to keep using old code setup for eixsting customers and new code setup for new customers. Or else export everything using new code and then import into the new terraform state</li> </ol>"},{"location":"ReleaseInfo/#automation-toolkit-release-v72-docker-image-release-v32","title":"Automation Toolkit Release v7.2 &amp; Docker Image Release v3.2","text":""},{"location":"ReleaseInfo/#date-may-26-2021","title":"Date - May 26, 2021","text":"<p>This is a minor release.</p> <ol> <li>Bug fix for export of policies having newline in description eg for policies added automatically for streaming</li> <li>Launch Linux 7.9 as OCS VM since 7.8 is not searcheable now and enable yum repos</li> <li>Change os.cmd to function calls for SetUPOCI</li> <li>Include CIS Features to enable cloud-guard, OSS, VCN Flow Logging</li> <li>CD3 Validator for Identity, Networking, Instances, Block Volumes</li> <li>Accept key value along with key var name in Instances Sheet</li> <li>Updated CD3 Templates as per CIS</li> </ol>"},{"location":"ReleaseInfo/#release-v712","title":"Release v7.1.2","text":""},{"location":"ReleaseInfo/#date-apr-12-2021","title":"Date - Apr 12, 2021","text":"<p>This is a minor release.</p> <ol> <li>Bug fix for CD3 LBR - Certs/PEM keys copied to outdir- this helps to resolve the path issue while RM upload. Export LBR also modified</li> <li>Bug fix for Instance Export - included root compartment, AD issue and Boot Volume not found issue.</li> <li>Removed installation of Development Tools from shell script on OCSVM.</li> <li>Added CD3 validation for DNS Label length for VCN and Subnets</li> </ol>"},{"location":"ReleaseInfo/#release-v711","title":"Release v7.1.1","text":""},{"location":"ReleaseInfo/#this-is-a-minor-release","title":"This is a minor release.","text":"<ol> <li>Bug fix for CD3 Network components validator - included check for invalid CIDR range having host bits set</li> <li>Bug fix for Security List Rules - allow all ports for TCP/UDP</li> <li>Removed unwanted packages from shell script - cfgparse, ipaddr, pycrypto, gcc</li> </ol>"},{"location":"ReleaseInfo/#release-v71","title":"Release v7.1","text":"<p>Date - Feb 12, 2021</p> <p>Below are the highlights of this release:</p> <ol> <li>Introduced new option in setUpOCI Menu to create RM Stack</li> </ol> <p>\u00a0 \u00a0* When this option is chosen, it will ask for the compartment where the RM stack has to be created.</p> <p>\u00a0 \u00a0* It will create stacks in the specified compartment in the home region</p> <p>\u00a0 \u00a0* RM Stack names: ocswork-- where  is the prefix mentioned in setUpOCI.properties file and  is the regions tenancy is subscribed to. <p>\u00a0 \u00a0* Uploads all files in outdir to RM Stack and also uploads the tfstate file if existing.</p> <p>\u00a0 \u00a0* Uses same RM Stack for multiple executions.</p> <ol> <li> <p>Bug fix for LBR Backend sets to allow same backend servers with different ports.</p> </li> <li> <p>OCSWork VM launched with TF version 0.13.4 in sync with Resource Manager in OCI</p> </li> <li> <p>CD3 templates as per CIS Standards</p> </li> </ol>"},{"location":"ReleaseInfo/#release-v701","title":"Release v7.0.1","text":"<p>This is a minor release.</p> <p>xrld package's latest release was not compatible and giving below issue with CD3:</p> <p></p> <p>It has been fixed by installing lower version of xlrd package.</p> <p>pip3 install xlrd==1.2.0</p> <p>It has been corrected and pushed to the master branch.</p>"},{"location":"ReleaseInfo/#major-release-v70","title":"Major Release v7.0","text":""},{"location":"ReleaseInfo/#date-oct-9-2020","title":"Date - Oct 9, 2020","text":"<ol> <li>Support for additional properties for OCI objects using Jinja2 templates</li> <li>Support for configuring Events and Notifications</li> <li>Support for export of Instances, block volumes, Tags, Events and Notifications etc to CD3</li> <li>Updated Terraform Configuration Files to support the Latest Terraform Version</li> <li>Support for Resource Manager</li> <li>Support to create and export Dynamic Groups</li> <li>Support to create and export Cost Tracking and Default Tags</li> <li>Support to create and export LBR Components- Cipher Suites, Rule Set and Path Route Set</li> <li>Support to attach or export 'Custom Backup Policy Attachments' to Block and Boot Volumes</li> </ol>"},{"location":"ReleaseInfo/#release-v611","title":"Release v6.1.1","text":"<p>creatOCSWork.py picks up latest Linux OCID and launches the OCSWork VM. However Linux 8 does not support many packages required by automation toolkit.</p> <p>Hence modified the code to launch Linux 7.8 incase ocs_vm_source_image_ocid is left empty in ocswork.properties.</p>"},{"location":"ReleaseInfo/#release-v61","title":"Release v6.1","text":""},{"location":"ReleaseInfo/#date-july-31-2020","title":"Date - July 31, 2020","text":"<p>Below are the highlights of this release:</p> <ol> <li>Addition of Description field for Security Rules and Route Rules. Keep using same CD3 but just add new column 'RuleDescription' at the end of both the sheets - SecRulesinOCI and RouteRulesinOCI</li> <li>New text files - OCI_Regions and OCI_Protocols have been introduced. If any new region gets supported by OCI, it can be added in OCI_Regions file. Similarly Protocol and its number mapping has been defined in OCI_Protocols file which will be used by Security Rules as well as NSG Rules.</li> <li>Automation Toolkit will now support duplicate compartment names like OCI does. Please refer to CD3-template.xlsx under example folder for sample data.</li> <li>Extra properties specific to OCItoOCI project have been removed from ocswork.properties and a new file ocswork_ocic.properties has been added to accomodate that.</li> <li>Support for multiple OCSWork VMs via separate config_for_delete files. A new input parameter has been added to ocswork.properties file.</li> <li>Support for Reserved Public IP for OCSWork VM. Reserved public IP will be assigned to OCSWork VM which you cna chose to retain also while destroying OCSWork VM.</li> <li> <p>a. Regions property has been removed and now tenancy's subscribed regions will be fetched using API and terraform directories would be created based on that. It would be good to subscribe tenancy to all required regions before setting up OCS Work VM or else create the region directory manually. b. Regions property has been removed from VCN Info tab of CD3 as well.</p> </li> <li> <p>CD3 Validator has been introduced. This will validate Networking tabs as of now. It will check for any Null Values, CIDR overlaps etc. </p> </li> <li>Support for Flex shapes for Instances. Please refer to CD3-template.xlsx under example folder for sample input data.</li> <li>Instead of LinuxLatest and WindowsLatest, OS value in CD3 template has been changed to Linux and Windows respectively. Variable names in variables_.tf has been changed accordingly. Support for LinuxLatest and WindowsLatest templates for instance will be deprecated from next release. <li>Support for Multiple Listeners for LBRs. Add new column 'ListenerName' in the CD3 sheet. Please refer to CD3-template.xlsx under example folder for sample input data.</li> <li>Support for Multiple export options for FSS. Please refer to CD3-template.xlsx under example folder for sample input data.</li> <li>Support for NSG export/import. Export process for non-greenfield tenancies will support export of NSGs and their import into terraform.</li> <li>GIT repo has been moved to OCI. SSH key needs to be setup for access to the repo. Private key is copied over to /root/.ssh folder. It is up to the developers if they want to keep the private key there for any future GIT updates or if they want to remove the key for security reasons.</li>"},{"location":"ReleaseInfo/#release-v601","title":"Release v6.0.1","text":""},{"location":"ReleaseInfo/#date-mar-23-2020","title":"Date - Mar 23, 2020","text":"<p>There was a bug in v6.0 where TF for Instances, FSS, LBR etc was not getting correct subnet name as created for subnets using NEtworking.</p> <p>It has been corrected and pushed to the master branch.</p>"},{"location":"ReleaseInfo/#major-release-v60","title":"Major Release v6.0","text":"<p>Below are the highlights of this release:</p> <ol> <li>Support for Non Green Field Tenancies. </li> <li>Removed common_seclist_name and seclist_per_subnet columns from Subnets Tab. Specify security lists to be created for a subnet as comma separated in seclist_names column.</li> <li>If DNS doesn't need to be enabled for a VCN or subnet, specify 'n' in dns_label column for that VCN or Subnet.</li> <li>Specify 'n' for route_table_name or seclist_names in Subnets tab if only Default Route Table or Default Secuirty List of VCN needs to be attached to the subnet.</li> <li>When you are running Modify Network, if there are any route tables or security lists which are not attached to any subnet or DRG or LPG then it will display the names in output like below:</li> </ol> <p>ATTENTION!!! Below RouteTables are not attached to any subnet or DRG and LPG; If you want to delete any of them, remove the TF file!!!</p> <p>ATTENTION!!! Below SecLists are not attached to any subnet; If you want to delete any of them, remove the TF file!!!</p>"},{"location":"ReleaseInfo/#release-v501","title":"Release v5.0.1","text":"<p>There was a bug in LPGs creation/peering. Corrected that and pushed as v5.0.1</p>"},{"location":"ReleaseInfo/#major-release-v50","title":"Major Release v5.0","text":""},{"location":"ReleaseInfo/#date-feb-7-2020","title":"Date - Feb 7, 2020","text":"<p>It has many new enhancements and features added to it.</p> <p>Detailed explanation about CD3 excel is at: CD3 Excel release v5.0</p> <p>Below are the highlights:</p> <ol> <li>yum utility won't break on OCS Work VM. Please use python setUpOCI.py  cmd and python fetch_compartments_to_variablesTF.py  cmd to execute automation. <li>Export of rules after network creation is a mandatory step. Single sheet- 'SecRulesinOCI' and 'RouteRulesinOCI' would be used to manage rules in OCI.</li> <li>Color Coding has been added to the exported rules.</li> <li>Support for specifying LPG names has been included. </li> <p>\u00a0 \u00a0 \u00a0 \u00a0 Format to specify LPG names:</p> <p>\u00a0 \u00a0 \u00a0 \u00a0 specify either y (like for other components) - this will give default name to the LPG whch is _lpg eg ProdVCN_lpg0  or the \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 name that you want to give to the LPG. <ol> <li>Peering section has been removed and merged in VCNs tab. Format for specifying peering in hub_spoke_peer_none column:</li> </ol> <p>\u00a0 \u00a0 \u00a0 \u00a0specify hub in the column for the VCN you want to mark as hub</p> <p>\u00a0 \u00a0 \u00a0 \u00a0specify spoke: if you want to mark a VCN as spoke to hub VCN <p>\u00a0 \u00a0 \u00a0 \u00a0specify peer: if you want to establish normal peering between 2 VCNs <p>\u00a0 \u00a0 \u00a0 \u00a0specify none if the VCN is a normal standalone VCN</p> <ol> <li>you can specify SGW target for route rules in OCI. specify as either object_storage or all_services</li> </ol> <p>When VCNs are specified in hub-spoke model, Route Tables associated with DRG and LPG get created automatically. Inter subnet communication and egress communication from all subnets is opened via SecRules. Initial Subnet Route rules are controlled by flags for each target in Subnets Tab. If any change is required to be done in default sec rules or route rules, they can be modified via cd3 after exporting them.</p> <p>CSV support for this version is still under progress.</p>"},{"location":"ReleaseInfo/#major-release-v40","title":"Major Release v4.0","text":"<p>Note  This version would require you to change your excel file and use the latest one since there is a column addition in the existing sheet.</p> <ol> <li>Added support to add a common security List across subnets apart from just Default Security List. This is done by adding a new column in Subnets tab \"common_seclist_name\" which specifies name of common seclist to be created and used for each subnet \u00a0 \u00a0  If left blank for a particular subnet that means the common seclist doesnt not need to be assigned to that subnet.</li> <li>Modified output files created for routes. Earlier tool used to create one TF file for all route tables. Now it would generate separate file for each Route Table like it does for Security List.</li> <li>Introduced option to create new VCN under Update Network</li> <li>Added Default DHCP options also to TF like for Default Security List</li> <li>Added support to include Description for a rule in NSGs. Added new column for this</li> <li>Modified DB Systems creation code. Separated tabs for DB system - VM, BM and Exa</li> <li>Fixed some minor issues with existing code</li> </ol>"},{"location":"ResourceManagerUpload/","title":"OCI Resource Manager Upload","text":""},{"location":"ResourceManagerUpload/#oci-resource-manager-upload","title":"OCI Resource Manager Upload","text":"<p>This option will upload the created Terraform files &amp; the tfstate (if present) to the OCI Resource Manager.</p> <p>When prompted, specify the Region to create/upload the terraform files to Resource Manager Stack. Multiple regions can be specified as comma separated values. Specify 'global' to upload RPC related components which reside in 'global' directory.</p> <p>On the next prompt, enter the Compartment where the Stack should be created if it is for the first time. The toolkit will create a Stack for the region specified previously under the specified compartment. For global resources, stack will be created in the home region.</p> <p>The Stack created will use Terraform 1.0.x. The upload includes terraform.tfstate file as well, if present. This is to sync the OCI Resource Manager Stack to that of your outdir.</p> <p>The toolkit also creates a rm_ocids.csv file in the outdir/ which has the information on the Resource Manager stack that is created. The format of the data in rm_ocids.csv is as follows -  <p>;;; <p>Example:</p> <p> </p> <p>To use an existing Resource Manager stack, enter the details in the format provided above into your outdir//rm_ocids.csv file.  <p>Sample Execution:</p> <p> </p> <p>[!IMPORTANT] If you are using remote state and upload the stack to OCI Resource Manager using Upload current terraform files/state to Resource Manager under Developer Services, then running terraform plan/apply from OCI Resource Manager will not work and show below error:</p> <p></p> <p>You will have to remove backend.tf from the directory, bring the remote state into local and then re-upload the stack. On choosing \"Developer Services\" in the SetUpOCI menu, choose \"Upload current terraform files/state to Resource Manager\" sub-option to upload the terraform outdir into OCI Resource Manager.</p>"},{"location":"RestructuringOutDirectory/","title":"Grouping of generated Terraform files (Creating independent tfstate files for each resource)","text":"<p>The CD3 Automation Toolkit was previously built to generate all the output Terraform files within a designated region directory. OCI components like - Network, Instances, LBaaS, Databases etc., were maintained in a single tfstate file. This was not a viable option for tenancies requiring huge infrastructure.</p> <p>Starting with the Automation Toolkit release v10.1, it is now possible to select separate directories for each Oracle Cloud Infrastructure (OCI) service supported by the toolkit.</p> <p>This can be configured while connecting your container to the OCI tenancy.</p> <p>A new parameter 'outdir_structure_file' has been introduced in tenancyconfig.properties using which can be used to configure single outdir or different outdir for each service.</p> <p>To enable independent service directories for the generated Terraform files, follow the below steps:</p> <ol> <li>Go to <code>/cd3user/oci_tools/cd3_automation_toolkit/user-scripts/tenancyconfig.properties</code>. Enter required config details. </li> </ol> <p>Users have the option to enable or disable multiple service outdirectories based on their specific requirements.</p> <p>To enable it, uncomment the outdir_structure_file parameter which has the pre-defined path to outdir_structure_file.properties. Refer to the screenshot below:</p> <p></p> <ol> <li>Under the same user-scripts folder, open outdir_structure_file.properties and modify the directory names if required. They are in the                                                    format:OCI_Service_Name=Directory_Name. <p>Note:  * Do not modify the OCI service Names specified on the left hand side.Modify the directory name specified on Right Hand Side * Directory will be created for that service under  directory. Do not provide absolute path. * To make any changes to the directory structure later, it is necessary to rerun the \"createTenancy.py\" script from scratch. * It is mandatory to specify the directory name for each service. <p></p> <p>Here, the network and nsg directories have been renamed to demo_network and demo_nsg respectively. The next steps to run the toolkit remain the same as specified in                  Greenfield workflow</p> <ol> <li> <p>Run <code>python createTenancyConfig.py tenancyconfig.properties</code> from user-scripts folder.</p> </li> <li> <p>Go to <code>/cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.propertiesfile</code> and add the CD3 Excel path. </p> <p>Change to the below directory  <code>cd /cd3user/oci_tools/cd3_automation_toolkit/</code></p> <p>Run the script<code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code></p> <p>Select required options. (Here,\"Network\", \"nsg\" options have been selected to verify the files under the \"demo_network\", \"demo_nsg\" folders)</p> <p>auto.tfvars for the respective services are created.</p> </li> <li> <p>Go to the region directory <code>/cd3user/tenancies/&lt;customer_name&gt;/terraform_files/\\&lt;region&gt;/</code> . It is clear that all the service-specific folders have been created              successfully.</p> <p></p> </li> <li> <p>Navigate to the demo-network folder. All the auto.tfvars and tfstate files related to Network service can be seen within the demo_network folder. Terraform operations like        terraform init, terraform plan, terraform apply etc., will be executed from within these folders.</p> <p></p> <p>Similarly for all the services, their respective auto.tfvars and tfstate files get grouped under their assigned directories. This makes it much easier to manage OCI resources using          terraform for large-scale infrastructures.</p> <p>Likewise, While doing an export from OCI to terraform, update the tenancyconfig.properties file with path to outdir_structure_file.properties similar to step1 and then follow the      steps to run the toolkit for Non-green field tenancies. With this, all the .sh files with import                      commands of a particular OCI service are grouped and can be easily managed.</p> </li> </ol>"},{"location":"SupportForCD3Validator/","title":"CD3 Validator Features","text":""},{"location":"SupportForCD3Validator/#cd3-validator-features","title":"CD3 Validator Features","text":"<p>With version v9.0 we have introduced validator for Multiple VCN CIDRs in Networking Tab. CD3 Validator helps you validate the Compartments, Groups, Policies, Network component entries, Instances, Block Volumes, FSS in your CD3 to ensure error free, smooth creation of the resources when Terraform is applied. Below is a list of checks done by the CD3 Validator: | Tab Name | Validation/Checks | |----- | --------------- | | Identity | This covers Compartments, Groups, Policies Tabs.<ul><li>Checks if the Region column contains Home Region</li><li>Checks for mandatory columns</li></ul> | | VCNs | <ul><li>Checks if the Columns - Region and Compartment have valid entries.</li><li>Checks if the VCN Names are duplicated in Column - VCN Name for the same region.</li><li>Validates the VCN CIDRs (Single and Multiple) - Checks for Overlapping/Duplicate addresses.</li><li>Checks the VCN CIDR ranges for host bits set.</li><li> Checks if the Column - DNS Label has any special characters.</li><li>Checks for NULL Values if any in all the Columns that is Required/Mandatory.</li><li>Notifies the current LPG Peering status for Review (Also indicates the new set of peering that will be established based on the entries in CD3).</li></ul> | | Subnets | <ul><li>Checks if the Columns - Region and Compartment have valid entries.</li><li>Checks if the VCN Names are part of VCN Tab in Column - VCN Name</li><li>Checks if the Column - DNS Label has any special characters or any Duplicate Values</li><li>Validates the Subnet CIDRs - Checks for Overlapping/Duplicate addresses</li><li>Checks the Subnet CIDR ranges for host bits set.</li><li>Checks for NULL Values if any in all the Columns that is Required/Mandatory</li><li>Cross Validates entries in Subnets and DHCP Tabs for Column - DHCP Options</li><li>Checks if Internet Gateways and Service Gateways are set appropriately.</li><li>Cross Validates entries in Subnets and VCNsTabs for Column - Subnet CIDR (Checks if the Subnet CIDR belongs to / falls under the VCN CIDR as mentioned in the Subnet's Tab)</li></ul> | | DHCP | <ul><li>Checks if the Columns - Region and Compartment have valid entries</li><li>Checks if the VCN Names are part of VCN Tab in Column - VCN Name</li><li>Check if there is value for Customer DNS Column if the entered type is 'CustomDNSServer'</li><li>Checks for NULL Values if any in all the Columns that is Required/Mandatory</li></ul> |  | DRGs | <ul><li>Checks if the Columns - Region and Compartment have valid entries</li><li>Checks if DRG Name entered is as per mentioned in VCNs tab</li><li>Checks for the valid format of Attached To column and if it contains VCN Name as mentioned in VCNs Tab.</li><li>Checks for valid format of column 'Import DRG Route Distribution Statements'</li><li>Checks that column 'Import DRG Route Distribution Statements' cannot have any value if colum 'Import DRG Route Distribution' is empty.</li></ul> | | Instances | <ul><li>Checks if the Columns - Region and Compartment have valid entries</li><li>Checks for mandatory columns - Region, Compartment Name, Availability Domain, Display Name, Subnet Name, SSH Key Var Name, Pub Address, Source Details, Shape</li><li>Checks if Subnet Name specified is valid as per Subnets Tab of CD3</li><li>Checks for valid values for columns - Availability Domain, Fault Domain, Source Details, Shape</li><li>Checks if the NSG names mentioned in NSGs column are part of NSGs tab of the CD3 excel.</li></ul> | | Block Volumes | <ul><li>Checks if the Columns - Region and Compartment have valid entries</li><li>Checks for mandatory columns Block Name, Availability Domain, Attach Type.</li><li>Checks for valid values for columns - Availability Domain, Attach Type, Attached to Instance.</li><li>Checks if AD mentioned in Block Volumes sheet is same as AD mentioned in Instances sheet for the instance to which block volume is to be attached.</li></ul> | | FSS | <ul><li>Checks if the Columns - Region and Compartment have valid entries</li><li>Checks for mandatory columns - Region, Compartment Name, Availability Domain, MountTarget Name, MountTarget SubnetName.</li><li>Checks if Subnet Name specified is valid as per Subnets Tab of CD3</li><li>Checks if the NSG names mentioned in NSGs column are part of NSGs tab of the CD3 excel.</li></ul> |</p> <p>Log file containing CD3 validator checks is generated at: /cd3user/tenancies//_cd3validator.log <p>Expected ERROR in the log file: Compartment Network does not exist in OCI.\u2192 These error mean that the component is not found in OCI. So, please make sure to create the Compartment \"Network\" before validating other tabs.</p>"},{"location":"SupportforAdditionalAttributes/","title":"Support for Additional Attributes","text":"<p>Follow the below steps to add an attribute that is not present already in your Excel sheet -</p> <ol> <li>Add the attribute name to the CD3 Excel sheet (based on the resource the attribute belongs to) as given in Terraform Official Documentation.</li> <li>Uncomment the attribute in .tf files (terraform modules in outdirectory, if they are commented). </li> <li>Uncomment the attribute in Jinja template for the resource attribute. (Resource to Jinja template mapping is available here)</li> <li>Update the variable file for any additional changes like image ocids, ssh public keys, etc</li> </ol> <p>Example 1: To add an attribute for Instances - (preserve_boot_volume)</p> <li>Here is the Terraform Hashicorp documentation for instances - https://registry.terraform.io/providers/oracle/oci/latest/docs/resources/core_instance </li> <li>Add an additional column preserve_boot_volume to the Instances Sheet as shown below. Optionally change the underscores to spaces for better readability. </li> <p></p> <p>Uncomment the parameter in instance.tf file if not already uncommented.</p> <p></p> <p>Uncomment the parameter in cd3_automation_toolkit\\Compute\\templates\\instance-template . Any line that is between {#  #} are commented in Jinja templates. From the screenshot below we note that the condition for preserve_boot_volume  is within the Jinja comments. Copy the highlighted line and place it after/outside line 184 (#}) as per below screenshot. <p>Before</p> <p></p> <p>After</p> <p></p> <p>Apart from the above changes, optionally, update the instance_ssh_keys and instance_source_ocids in your variables file before executing the toolkit to generate the auto.tfvars for instances.</p> <p>Exemple 2 : To Add Freeform Tags</p> <p>Automation Tool Kit allows the tagging of resources. To use this option, the user is required to add the below column to the appropriate CD3 sheet. Ex: To Tag your Instances, Open the \u2018Instances\u2019 sheet of your CD3 and add the below column at the end.</p> <li>FreeForm Tags</li> <pre><code>Note\n\nThe Tag Values (Default and Freeform Tags) specified will apply to all the resources in the tab.\nEx: The tags applied to VCNs will not be applied to its objects like IGW, NGW, SGW, LPG, etc\nEmpty column values are allowed for FreeForm and Defined Tags; when used it does not attach any tags to the resource. eg: Row 1 in the below example\nSemi Colon is used as Delimiter between multiple tag values (Example as shown below)\n</code></pre> <p>Allowed Values for Tags include the following formats: (Semi-colon delimited values to be entered)</p> <p>Example:</p> S.No Freeform Tags Defined Tags 1. 2. Network=Test1;Network2=Test40 Operations.CostCenter=01;Users.Name=user01 3. Network=Test2; Network2=Test4 Application.Env=Dev 4. Network= OS.Version= 5. testing Platform.Usage <pre><code>Export of new attributes is only supported if the attribute name of Terraform documentation matches that of the Python SDK. Export may fail to fetch the data incase there is a mismatch of the variable names.\n</code></pre>"},{"location":"SupportforAdditionalAttributes/#resource-to-template-mapping-","title":"Resource to Template Mapping -","text":"<p>Added New options for CIS compliance.</p> <p>The following Table maps the Excel Sheet to the Resources to the Templates:</p> <p>CD3-CIS-template.xlsx:</p> Tab Name/SetUpOCI Option Resource Name(OCI Console) Jinja2 Template Path Jinja2 Template Name! VCNsSubnetsDHCPRouteRulesinOCISecRulesinOCINSGs Networking: Virtual Cloud Networks cd3_automation_toolkit\\Network\\BaseNetwork\\templates\\ major-objects-drgs-templatemajor-objects-igws-templatemajor-objects-ngws-templatemajor-objects-lpgs-templatemajor-objects-sgws-templatemajor-objects-vcns-templatemajor-objects-drg-attachments-templatemajor-objects-default-dhcp-templatesubnet-templatecustom-dhcp-templatedrg-data-source-templatedrg-route-distribution-statement-templatedrg-route-distribution-templatedrg-route-rule-templatedrg-route-table-templatedefault-route-table-templateroute-rule-templateroute-table-templatedefault-seclist-templateseclist-templatesec-rule-templatensg-rule-templatensg-template Tags Governance: Tag Namespace cd3_automation_toolkit\\Governance\\Tagging\\templates tags-namespaces-templatetags-keys-templatetags-defaults-template OSS Object Storage Bucket cd3_automation_toolkit\\Storage\\ObjectStorage\\templates oss-policy-templateoss-template OKE Developer Service: Oracle Kubernetes Service cd3_automation_toolkit\\DeveloperServices\\OKE\\templates\\ cluster-templatenodepool-template NLB-ListenersNLB-BackendSets-BackendServers Networking: Network Load Balancers cd3_automation_toolkit\\Networking\\LoadBalancers\\templates\\ nlb-templatenlb-backend-set-templatenlb-backend-server-templatenlb-listener-templatenlb-reserved-ips-template Logging VCN Flow LogsObject Storage Bucket Logs cd3_automation_toolkit\\ManagementServices\\Logging\\templates logging-template LB-Hostname-CertsBackendSet-BackendServerRuleSetPathRouteSetLB-Listener Networking: Load Balancers cd3_automation_toolkit\\Networking\\LoadBalancers\\templates\\ lbr-templatecertificate-templatehostname-templatecipher-suite-templatebackend-server-templatebackend-set-templaterule-set-templateaccess-control-rules-templateaccess-method-rules-templatehttp-header-rules-templaterequest-response-header-rules-templateuri-redirect-rules-templatepath-route-set-templatepath-route-rules-templatelistener-templatelbr-reserved-ips-template Key Vault Key and Vault cd3_automation_toolkit\\Security\\KeyVault\\templates keys-templatevaults-template FSS File Storage: File Systems cd3_automation_toolkit\\Storage\\FileStorage\\templates\\ fss-templateexport-resource-templateexport-options-templatemount-target-template DedicatedVMHostsInstances Compute:Dedicated Virtual Machine HostsInstances cd3_automation_toolkit\\Compute\\templates\\ dedicatedvmhosts-templateinstances-template CompartmentsGroupsPolicies Identity: CompartmentsGroupsDynamic GroupsPolicies cd3_automation_toolkit\\Identity\\Compartments\\templates  cd3_automation_toolkit\\Identity\\Groups\\templates  cd3_automation_toolkit\\Identity\\Policies\\templates  compartments-templategroups-templatepolicies-template Cloud Guard Cloud Guard cd3_automation_toolkit\\Security\\CloudGuard\\templates cloud-guard-config-templatecloud-guard-target-template Budgets Governance: Budgets cd3_automation_toolkit\\Governance\\Billing\\templates budget-alert-rule-templatebudget-template BlockVolumes Block Storage: Block Volumes cd3_automation_toolkit\\Storage\\BlockVolume\\templates\\ blockvolumes-template ADBDBSystems-VM-BMEXA-InfraEXA-VMClusters Autonomous Data WarehouseAutonomous Transaction ProcessingBare Metal, VM and Exadata Infra, and Exadata VM Clusters cd3_automation_toolkit\\Database\\templates\\ adb-templatedbsystems-vm-bm-templateexa-infra-templateexa-vmclusters-template <p>CD3-CIS-ManagementServices-template.xlsx</p> Tab Name/SetUpOCI Option Resource Name(OCI Console) Jinja2 Template Path Jinja2 Template Name! NotificationsEventsAlarmsServiceConnectors Application Integration:NotificationEvents ServiceAlarmsService Connector Hub cd3_automation_toolkit\\ManagementServices\\EventsAndNotifications\\templates  cd3_automation_toolkit\\ManagementServices\\Monitoring\\templates  cd3_automation_toolkit\\ManagementServices\\ServiceConnectorHub\\templates  actions-templateevents-templatenotifications-topics-templatenotifications-subscriptions-templateservice-connectors-template"},{"location":"Upgrade_Toolkit/","title":"Steps to Upgrade Your Toolkit (For Existing Customers using older versions):","text":""},{"location":"Upgrade_Toolkit/#upgrade-to-release-v202410","title":"Upgrade to Release v2024.1.0","text":"<p>This is a major release with introduction of CI/CD using Jenkins. 1. Follow the steps in Launch Docker Container to build new image with latest code and launch the container by specifying new path for  to create a fresh outdir. 2. Use Non Greenfield workflow to export the required OCI services into new excel sheet and the tfvars. Run terraform import commands also. 3. Once terraform is in synch, Switch to Greenfield workflow and use for any future modifications to the infra."},{"location":"Upgrade_Toolkit/#upgrade-to-release-v121-from-v12","title":"Upgrade to Release v12.1 from v12","text":"<ol> <li>Follow the steps in Launch Docker Container to build new image with latest code and launch the container by specifying same path for  to keep using same outdir. <li>Copy sddc.tf from /cd3user/oci_tools/cd3_automation_toolkit/user-scripts/terraform_files/ to /cd3user/tenancies//terraform_files//. <li>Copy the contents of modules directory from /cd3user/oci_tools/cd3_automation_toolkit/user-scripts/terraform_files/modules/ to /cd3user/tenancies//terraform_files/. <li>Copy the sddcs variable block from /cd3user/oci_tools/cd3_automation_toolkit/user-scripts/terraform_files/variables_example.tf and replace it in your variables_\\.tf file"},{"location":"Upgrade_Toolkit/#upgrade-to-release-v12","title":"Upgrade to Release v12","text":""},{"location":"Upgrade_Toolkit/#upgrade-to-release-v111-from-v11","title":"Upgrade to Release v11.1 from v11","text":"<ol> <li>Follow the steps in Launch Docker Container to build new image with latest code and launch the container by specifying same path for  to keep using same 1. Follow the steps in Launch Docker Container to build new image with latest code and launch the container by specifying new path for  to create a fresh outdir. <li>Use Non Greenfield workflow to export the required OCI services into new excel sheet and the tfvars. Run terraform import commands also.</li> <li>Once terraform is in synch, Switch to Greenfield workflow and use for any future modifications to the infra.outdir.</li>"},{"location":"Upgrade_Toolkit/#upgrade-to-release-v11","title":"Upgrade to Release v11","text":"<ol> <li>Follow the steps in Launch Docker Container to build new image with latest code and launch the container by specifying new path for  to create a fresh outdir. <li>Use Non Greenfield workflow to export the required OCI services into new excel sheet and the tfvars. Run terraform import commands also.</li> <li>Once terraform is in synch, Switch to Greenfield workflow and use for any future modifications to the infra.</li>"},{"location":"Upgrade_Toolkit/#upgrade-to-release-v102-from-v101","title":"Upgrade to Release v10.2 from v10.1","text":"<ol> <li>Follow the steps in Launch Docker Container to build new image with latest code and launch the container by specifying same path for  to keep using same outdir. <li>There are minor upgrades to terraform modules. In order to use the latest modules, copy the contents(modules directory and all .tf files from /cd3user/oci_tools/cd3_automation_toolkit/user-scripts/terraform to /cd3user/tenancies//terraform_files/. Move existing variables_\\&lt;region&gt;.tf to some backup and Copy OCI Connect Variables block from  this file into variables_example.tf file and rename it to  variables_\\&lt;region&gt;.tf"},{"location":"Upgrade_Toolkit/#upgrade-to-release-v101-from-v10","title":"Upgrade to Release v10.1 from v10","text":"<ol> <li>Follow the steps in Launch Docker Container to build new image with latest code and launch the container by specifying same path for  to keep using same outdir. <li>There are minor upgrades to terraform modules. In order to use the latest modules, copy the contents(modules directory and all .tf files except variables_example.tf) from /cd3user/oci_tools/cd3_automation_toolkit/user-scripts/terraform to /cd3user/tenancies//terraform_files/. <li>Execute terraform init -upgrade from outdir</li> <li>If you had utilized 'Upload current terraform files/state to Resource Manager' option under 'Developer Services' to upload terraform stack to Resource Manager for v10, then you must copy existing 'rm_ocids.csv' file from /cd3user/tenancies//terraform_files/ to /cd3user/tenancies//terraform_files/ before using this option again with v10.1. <li>Changes to the CD3 excel sheet templates include correction of the dropdowns for all tabs, few changes in Policies tab wrt policy statements. So users can keep using the v10 templates.</li> <li>The new release supports a separate directory for each service. In order to use this feature for existing customers, execute createTenancy.py using a new outdir with  'outdir_structure_file' parameter set and then run export of the tenanncy into this new outdir using Non Greenfield workflow.</li>"},{"location":"Upgrade_Toolkit/#upgrade-to-release-v10-from-v921","title":"Upgrade to Release v10 from v9.2.1","text":"<ol> <li>Follow the steps in Launch Docker Container to build new image with latest code and launch the container by specifying same path for  to keep using same outdir. <li>Use new excel sheet templates to use OKE and SCH.</li> <li>For existing services, user can continue using existing outdir.</li>   | Main menu | | :---- |"},{"location":"Workflows-jenkins/","title":"Using the Automation Toolkit via Jenkins","text":"<p>Jenkins integraton with the toolkit is provided to jump start your journey with CI/CD for IaC in OCI. A beginner level of understanding of Jenkins is required.</p>"},{"location":"Workflows-jenkins/#pre-reqs-for-jenkins-configuration","title":"Pre-reqs for Jenkins Configuration","text":"<ul> <li>The configurations are done when you execute createTenancyConfig.py in Connect container to OCI Tenancy. Please validate them:</li> <li>jenkins.properties file is created under /cd3user/tenancies/jenkins_home  as per input parameters in tenancyConfig.properties</li> <li>An Object Storage bucket is created in OCI in the specified compartment to manage tfstate remotely. </li> <li>Customer Secret Key is configured for the user for S3 credentials of the bucket. </li> <li>A DevOps Project, Repo and Topic are created in OCI in the specified compartment to store terraform_files. GIT is configured on the container with config file at <code>/cd3user/.ssh/config</code> </li> </ul>"},{"location":"Workflows-jenkins/#bootstrapping-of-jenkins-in-the-toolkit","title":"Bootstrapping of Jenkins in the toolkit","text":"<ul> <li> <p>Execute below cmd to start Jenkins -  <code>/usr/share/jenkins/jenkins.sh &amp;</code></p> </li> <li> <p>Access Jenkins URL using -</p> </li> <li>https://\\:\\\\/ \\     &gt; Notes:      &gt; - \\ is the port mapped with local system while docker container creation Eg: 8443.      &gt; -  Network Connectivity should be allowed on this host and port.      &gt; -  Please make sure to use a private server or a bastion connected server with restricted access(i.e. not publicly available). <li>It will prompt you to create first user to access Jenkins URL. This will be the admin user.</li> <li>The Automation Toolkit only supports a single user Jenkins setup in this release.</li> <li>Once you login, Jenkins Dashbord will be displayed.</li> <p></p>   | :arrow_backward: Automation Toolkit via CLI | Next :arrow_forward: | | :---- | -------: |"},{"location":"Workflows/","title":"Using the Automation Toolkit via CLI","text":""},{"location":"Workflows/#prepare-setupociproperties","title":"Prepare setUpOCI.properties","text":"<p>Current Version:  setUpOCI.properties v2024.1.0</p> <p>Make sure to use/modify the properties file at /cd3user/tenancies //_setUpOCI.properties during executions. <pre><code>[Default]\n\n#Input variables required to run setUpOCI script\n\n#path to output directory where terraform file will be generated. eg /cd3user/tenancies/&lt;customer_name&gt;/terraform_files\noutdir=\n\n#prefix for output terraform files eg &lt;customer_name&gt; like demotenancy\nprefix=\n\n# auth mechanism for OCI APIs - api_key,instance_principal,session_token\nauth_mechanism=\n\n#input config file for Python API communication with OCI eg /cd3user/tenancies/&lt;customer_name&gt;/.config_files/&lt;customer_name&gt;_config;\nconfig_file=\n\n# Leave it blank if you want single outdir or specify outdir_structure_file.properties containing directory structure for OCI services.\noutdir_structure_file=\n\n#path to cd3 excel eg /cd3user/tenancies/&lt;customer_name&gt;\\CD3-Customer.xlsx\ncd3file=\n\n#specify create_resources to create new resources in OCI(greenfield workflow)\n#specify export_resources to export resources from OCI(non-greenfield workflow)\nworkflow_type=create_resources\n</code></pre> Variable Description Example outdir Path to output directory where terraform files will be generated /cd3user/tenancies//terraform_files prefix Prefix for output terraform files \\ auth_mechanism Authentication Mechanism for OCI APIs api_key config_file Python config file /cd3user/tenancies//.config_files/_config outdir_structure_file Parameter specifying single outdir or different for different services Blank or _outdir_structure_file.properties cd3file Path to the Excel input file /cd3user/tenancies//testCD3. xlsx workflow_type greenfield workflow or non-greenfield workflow See  Automation Toolkit Workflows for more information"},{"location":"Workflows/#automation-toolkit-workflows","title":"Automation Toolkit Workflows:","text":"<p>CD3 Automation Tool Kit supports 2 main workflows: 1.  Create Resources in OCI (Greenfield Workflow) - Empty OCI tenancy (or) do not need to modify / use any existing resources. 2.  Export Resources from OCI (Non-Greenfield Workflow) - Need to use / manage existing resources.  Export existing resources into CD3 &amp; TF State, then use the Greenfield workflow.</p>"},{"location":"Workflows/#execution-steps-overview","title":"Execution Steps Overview:","text":"<p>Choose the appropriate CD3 Excel Sheet and update the setUpOCI.properties file at /cd3user/tenancies//_setUpOCI.properties and run the commands below: <p>Step 1: Change Directory to 'cd3_automation_toolkit' <code>cd /cd3user/oci_tools/cd3_automation_toolkit/</code></p> <p>Step 2: Place Excel sheet at appropriate location in your container and provide the corresponding path in cd3file parmeter of: /cd3user/tenancies //_setUpOCI.properties file <p>Step 3  Execute the setUpOCI Script:                                                                                                                                           <code>python setUpOCI.py /cd3user/tenancies/&lt;customer_name&gt;/&lt;customer_name&gt;_setUpOCI.properties</code>  \u2192 Example execution of the script:</p> <p><pre><code>[cd3user@25260a87b137 cd3_automation_toolkit]$ python setUpOCI.py /cd3user/tenancies/demotenancy/demotenancy_setUpOCI.properties\nUpdated OCI_Regions file !!!\nScript to fetch the compartment OCIDs into variables file has not been executed.\nDo you want to run it now? (y|n):\n</code></pre> \u2192 This prompt appears for the very first time when you run the toolkit or when any new compartments are created using the toolkit. Enter 'y' to fetch the details of compartment OCIDs into variables file. \u2192 After fetching the compartment details, the toolkit will display the menu options.</p> <p></p>   | :arrow_backward: Prev | Next :arrow_forward: | | :---- | -------: |"},{"location":"cli_jenkins/","title":"Switch between using the toolkit via CLI and Jenkins UI","text":"<p>Note - It is recommended to stick to using the toolkit either via CLI or via Jenkins.</p> <p>There can be scenarios when you need to update the terraform_files folder manually via CLI. Below are some examples:</p> <ul> <li>You executed setUpOCI script to generate tfvars for some resources via CLI.</li> <li>You updated variables_\\&lt;region&gt;.tf file to update image OCID or SSH Key for Compute or Database etc.</li> </ul> <p>Please folow below steps to sync local terraform_files folder to OCI DevOps GIT Repo:</p> <ul> <li><code>cd /cd3user/tenancies/&lt;customer_name&gt;/terraform_files</code></li> <li><code>git status</code> Below screenshot shows changes in variables_phoenix.tf file under phoenix/compute folder.</li> </ul> <p></p> <ul> <li> <p><code>git add -A .</code></p> </li> <li> <p><code>git commit -m \"msg\"</code></p> <p></p> </li> <li> <p><code>git push</code></p> <p></p> </li> </ul> <p></p>   | :arrow_backward: Prev | :arrow_forward: Next | | :---- | -------: |"},{"location":"multiple_options_GF-Jenkins/","title":"Provisioning of multiple services together","text":"<p>Note - For any service that needs Network details eg compute, database, loadbalancers ets, 'network' pipeline needs to be executed prior to launching that service pipeline.</p> <p>Multiple options can be selected simultaneously while creating resources in OCI using setUpOCI pipeline . But if one of the services is dependent upon the availability of another service eg  'Network' (Create Network) and 'Compute' (Add Instances); In such scenarios, terraform-apply pipeline for compute will fail as shown in below screenshot (last stage in the pipeline) -  </p> <ul> <li>Clicking on 'Logs' for Stage: sanjose/compute and clicking on the pipeline will dispay below -</li> </ul> <p> </p> <ul> <li>Clicking on 'Logs' for Stage Terraform Plan displays - </li> </ul> <p></p> <ul> <li>This is expected because pipeline for 'compute' expects network to be already existing in OCI to launch a new instance.</li> <li>To resolve this, Proceed with terraform-apply pipeline for 'network' and once it is successfuly completed, trigger terraform-apply pipeline for 'compute' manually by clicking on 'Build Now' from left menu.</li> </ul> <p></p> <p></p>   | :arrow_backward: Prev | Next :arrow_forward: | | :---- | -------: |"},{"location":"prerequisites/","title":"Prerequisites","text":"<ul> <li>Git</li> <li>Any docker CLI compatible platform such as Docker or Rancher. Part 2 - How to Install and Configure Rancher Desktop with CD3 \u2013  3m \u2013 How to Install and Configure Rancher Desktop with CD3.</li> <li>Local Directory - A directory in your local system that will be shared with the container to hold the generated Terraform files.</li> <li>OCI Tenancy Access Requirement - Appropriate IAM policies must be in place for each of the resources that the user may try to create. Minimum requirement   for the user to get started is to have the ability to read to the tenancy.</li> </ul>"},{"location":"remote_state/","title":"Store Terraform State into Object Storage Bucket","text":"<p>[!Caution] When utilizing remote state and deploying the stack to OCI Resource Manager through the Upload current terraform files/state to Resource Manager option under Developer Services, attempting to execute terraform plan/apply directly from OCI Resource Manager may result in below error.</p> <p></p> <p>This option is disabled while using the toolkit via Jenkins. While using it via CLI, you will have to remove backend.tf from the directory, bring the remote state into local and then upload the stack.</p> <p> * Toolkit provides the option to store terraform state file(tfstate) into Object Storage bucket. * This can be achieved by setting <code>use_remote_state=yes</code> under Advanced Parameters in <code>tenancyconfig.properties</code> file while executing <code>createTenancyConfig.py</code>. * Upon setting above parameter the script will -     - create a versioning enabled bucket in OCI tenancy in the specified region(if you don't specify anything in <code>remote_state_bucket_name</code> parameter to use an existing bucket)     - create a new customer secret key for the user, and configure it as S3 credentials to access the bucket. Before executing the createTenancyConfig.py script, ensure that the specified user in the DevOps User Details or identified by the user OCID does not already have the maximum limit of two customer secret keys assigned. </p> <ul> <li>backend.tf file that gets generated -</li> </ul> <pre><code>terraform {\nbackend \"s3\" {\n  key      = \"&lt;region_name&gt;/&lt;service_dir_name&gt;/terraform.tfstate\"\n  bucket   = \"&lt;customer_name&gt;-automation-toolkit-bucket\"\n  region   = \"&lt;region&gt;\"\n  endpoint = \"https://&lt;namespace&gt;.compat.objectstorage.&lt;region&gt;.oraclecloud.com\"\n  shared_credentials_file     = \"/cd3user/tenancies/&lt;customer_name&gt;/.config_files/&lt;customer_name&gt;_s3_credentials\"\n  skip_region_validation      = true\n  skip_credentials_validation = true\n  skip_metadata_api_check     = true\n  force_path_style            = true\n  }\n}  \n</code></pre> <ul> <li> <p>For single outdir, tfstate for all subscribed regions will be stored as <code>&lt;region&gt;/terraform.tfstate</code> eg <code>london/terraform.tfstate</code> for london <code>phoenix/terraform.tfstate</code> for phoenix. See below screenshot showing objects in the bucket storing remote state:   </p> </li> <li> <p>For multi outdir, tfstate for all services in all subscribed regions will be stored as <code>&lt;region&gt;/&lt;service_dir_name&gt;/terraform.tfstate</code> eg <code>london/tagging/terraform.tfstate</code> for tagging dir in london region. See below screenshot showing objects in the bucket storing remote state:     </p> </li> </ul> <p></p>   | :arrow_backward: Prev | | :---- |"},{"location":"test/","title":"Test","text":"|table1|     |---|     |text1|         |table 2|     |---|     |text2|"},{"location":"blog/","title":"Blog","text":""}]}